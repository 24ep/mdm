generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                                                      String                        @id @default(uuid()) @db.Uuid
  email                                                   String                        @unique
  name                                                    String
  password                                                String
  role                                                    String                        @default("USER")
  avatar                                                  String?
  createdAt                                               DateTime                      @default(now()) @map("created_at")
  updatedAt                                               DateTime                      @updatedAt @map("updated_at")
  isActive                                                Boolean                       @default(true) @map("is_active")
  passwordChangedAt                                       DateTime?                     @map("password_changed_at")
  requiresPasswordChange                                  Boolean                       @default(false) @map("requires_password_change")
  failedLoginAttempts                                     Int                           @default(0) @map("failed_login_attempts")
  lockoutUntil                                            DateTime?                     @map("lockout_until")
  allowedLoginMethods                                     String[]                      @default([]) @map("allowed_login_methods")
  twoFactorSecret                                         String?                       @map("two_factor_secret")
  isTwoFactorEnabled                                      Boolean                       @default(false) @map("is_two_factor_enabled")
  twoFactorBackupCodes                                    String[]                      @default([]) @map("two_factor_backup_codes")
  apiCollections                                          ApiCollection[]               @relation("UserApiCollections")
  apiEnvironments                                         ApiEnvironment[]              @relation("UserApiEnvironments")
  apiRequestHistory                                       ApiRequestHistory[]           @relation("UserApiRequestHistory")
  apiRequests                                             ApiRequest[]                  @relation("UserApiRequests")
  apiWorkspaces                                           ApiWorkspace[]                @relation("UserApiWorkspaces")
  auditLogs                                               AuditLog[]                    @relation("UserAuditLogs")
  chatSessions                                            ChatSession[]                 @relation("UserChatSessions")
  costRecords                                             ChatbotCostRecord[]           @relation("UserCostRecords")
  chatbotVersions                                         ChatbotVersion[]              @relation("ChatbotVersionCreator")
  createdChatbots                                         Chatbot[]                     @relation("ChatbotCreator")
  createdCycles                                           Cycle[]                       @relation("CycleCreator")
  createdDataModels                                       DataModel[]                   @relation("DataModelCreator")
  createdDataRecords                                      DataRecord[]                  @relation("DataRecordCreator")
  createdEavEntities                                      EavEntity[]                   @relation("EavEntityCreator")
  exportJobs                                              ExportJob[]                   @relation("ExportJobCreator")
  importJobs                                              ImportJob[]                   @relation("ImportJobCreator")
  importProfiles                                          ImportProfile[]               @relation("ImportProfileCreator")
  infrastructureInstances                                 InfrastructureInstance[]      @relation("UserInfrastructureInstances")
  intakeSubmissions                                       IntakeSubmission[]            @relation("IntakeSubmissionUser")
  knowledgeCollectionMembers                              KnowledgeCollectionMember[]   @relation("UserKnowledgeCollectionMembers")
  knowledgeCollections                                    KnowledgeCollection[]         @relation("UserKnowledgeCollections")
  knowledgeComments                                       KnowledgeComment[]            @relation("UserKnowledgeComments")
  knowledgeCommentResolutions                             KnowledgeComment[]            @relation("UserKnowledgeCommentResolutions")
  knowledgeDocumentVersions                               KnowledgeDocumentVersion[]    @relation("UserKnowledgeDocumentVersions")
  knowledgeDocuments                                      KnowledgeDocument[]           @relation("UserKnowledgeDocuments")
  knowledgeDocumentUpdates                                KnowledgeDocument[]           @relation("UserKnowledgeDocumentUpdates")
  knowledgeMentionCreators                                KnowledgeMention[]            @relation("UserKnowledgeMentionCreators")
  knowledgeMentions                                       KnowledgeMention[]            @relation("UserKnowledgeMentions")
  knowledgePresence                                       KnowledgePresence[]           @relation("UserKnowledgePresence")
  knowledgeShareCreators                                  KnowledgeShare[]              @relation("UserKnowledgeShareCreators")
  knowledgeShares                                         KnowledgeShare[]              @relation("UserKnowledgeShares")
  knowledgeStars                                          KnowledgeStar[]               @relation("UserKnowledgeStars")
  createdMilestones                                       Milestone[]                   @relation("MilestoneCreator")
  createdModules                                          Module[]                      @relation("ModuleCreator")
  leadModules                                             Module[]                      @relation("ModuleLead")
  notifications                                           Notification[]                @relation("UserNotifications")
  agentThreads                                            OpenAIAgentThread[]           @relation("UserAgentThreads")
  platform_integrations                                   PlatformIntegration[]
  pluginReviewHelpful                                     PluginReviewHelpful[]         @relation("UserPluginReviewHelpful")
  pluginReviews                                           PluginReview[]                @relation("UserPluginReviews")
  createdProjects                                         Project[]                     @relation("ProjectCreator")
  createdReleases                                         Release[]                     @relation("ReleaseCreator")
  report_audit_logs                                       report_audit_logs[]
  report_categories                                       ReportCategory[]
  report_folders                                          ReportFolder[]
  report_integrations                                     report_integrations[]
  report_permissions_report_permissions_created_byTousers ReportPermission[]            @relation("report_permissions_created_byTousers")
  report_permissions_report_permissions_user_idTousers    ReportPermission[]            @relation("report_permissions_user_idTousers")
  report_share_links                                      report_share_links[]
  report_templates                                        report_templates[]
  report_versions                                         report_versions[]
  reports                                                 Report[]
  serviceInstallations                                    ServiceInstallation[]         @relation("UserServiceInstallations")
  serviceManagementAssignments                            ServiceManagementAssignment[] @relation("UserServiceManagementAssignments")
  spaceMemberships                                        SpaceMember[]                 @relation("UserSpaceMembers")
  createdSpaces                                           Space[]                       @relation("SpaceCreator")
  teamMemberships                                         TeamMember[]                  @relation("UserTeamMembers")
  assignedTickets                                         TicketAssignee[]              @relation("TicketAssignees")
  ticketComments                                          TicketComment[]               @relation("TicketCommentAuthor")
  ticketTimeLogs                                          TicketTimeLog[]               @relation("TicketTimeLogUser")
  createdTickets                                          Ticket[]                      @relation("TicketCreator")
  websitePWAVersions                                      WebsitePWAVersion[]           @relation("WebsitePWAVersionCreator")
  createdWebsitePWAs                                      WebsitePWA[]                  @relation("WebsitePWACreator")

  @@map("users")
}

model Space {
  id                      String                   @id @default(uuid()) @db.Uuid
  name                    String
  description             String?
  slug                    String                   @unique
  isDefault               Boolean                  @default(false) @map("is_default")
  isActive                Boolean                  @default(true) @map("is_active")
  icon                    String?
  logoUrl                 String?                  @map("logo_url")
  features                Json?                    @default("{}")
  sidebarConfig           Json?                    @map("sidebar_config")
  enableAssignments       Boolean                  @default(true) @map("enable_assignments")
  enableBulkActivity      Boolean                  @default(true) @map("enable_bulk_activity")
  enableWorkflows         Boolean                  @default(true) @map("enable_workflows")
  enableDashboard         Boolean                  @default(true) @map("enable_dashboard")
  createdBy               String                   @map("created_by") @db.Uuid
  createdAt               DateTime                 @default(now()) @map("created_at")
  updatedAt               DateTime                 @updatedAt @map("updated_at")
  deletedAt               DateTime?                @map("deleted_at")
  apiWorkspaces           ApiWorkspace[]           @relation("SpaceApiWorkspaces")
  chatSessions            ChatSession[]            @relation("SpaceChatSessions")
  chatbots                Chatbot[]                @relation("SpaceChatbots")
  dataModels              DataModelSpace[]         @relation("SpaceDataModels")
  exportJobs              ExportJob[]              @relation("SpaceExportJobs")
  externalConnections     ExternalConnection[]     @relation("SpaceExternalConnections")
  importJobs              ImportJob[]              @relation("SpaceImportJobs")
  importProfiles          ImportProfile[]          @relation("SpaceImportProfiles")
  infrastructureInstances InfrastructureInstance[] @relation("SpaceInfrastructureInstances")
  intakeForms             IntakeForm[]             @relation("SpaceIntakeForms")
  kanbanConfigs           KanbanConfig[]           @relation("SpaceKanbanConfigs")
  knowledgeCollections    KnowledgeCollection[]    @relation("SpaceKnowledgeCollections")
  notebooks               Notebook[]               @relation("SpaceNotebooks")
  agentThreads            OpenAIAgentThread[]      @relation("SpaceAgentThreads")
  pluginReviews           PluginReview[]           @relation("SpacePluginReviews")
  projects                Project[]                @relation("SpaceProjects")
  report_integrations     report_integrations[]
  reportSpaces            ReportSpace[]            @relation("SpaceReports")
  serviceInstallations    ServiceInstallation[]    @relation("SpaceServiceInstallations")
  attachmentStorage       SpaceAttachmentStorage[] @relation("SpaceAttachments")
  members                 SpaceMember[]            @relation("SpaceMembers")
  creator                 User                     @relation("SpaceCreator", fields: [createdBy], references: [id])
  ticketSpaces            TicketSpace[]            @relation("SpaceTicketSpaces")
  websitePWAs             WebsitePWA[]             @relation("SpaceWebsitePWAs")

  @@map("spaces")
}

model SpaceMember {
  id      String @id @default(uuid()) @db.Uuid
  spaceId String @map("space_id") @db.Uuid
  userId  String @map("user_id") @db.Uuid
  role    String @default("MEMBER")
  space   Space  @relation("SpaceMembers", fields: [spaceId], references: [id], onDelete: Cascade)
  user    User   @relation("UserSpaceMembers", fields: [userId], references: [id], onDelete: Cascade)

  @@unique([spaceId, userId])
  @@map("space_members")
}

model EntityType {
  id                   String                 @id @default(uuid()) @db.Uuid
  name                 String                 @unique
  displayName          String                 @map("display_name")
  description          String?
  parentId             String?                @map("parent_id") @db.Uuid
  isAbstract           Boolean                @default(false) @map("is_abstract")
  isActive             Boolean                @default(true) @map("is_active")
  sortOrder            Int                    @default(0) @map("sort_order")
  metadata             Json?                  @default("{}")
  createdAt            DateTime               @default(now()) @map("created_at")
  updatedAt            DateTime               @updatedAt @map("updated_at")
  deletedAt            DateTime?              @map("deleted_at")
  attributeGroups      AttributeGroup[]       @relation("EntityTypeAttributeGroups")
  childInheritances    AttributeInheritance[] @relation("ChildEntityType")
  parentInheritances   AttributeInheritance[] @relation("ParentEntityType")
  attributes           EavAttribute[]         @relation("EntityTypeAttributes")
  referencedAttributes EavAttribute[]         @relation("ReferenceEntityType")
  entities             EavEntity[]            @relation("EntityTypeEntities")
  parent               EntityType?            @relation("EntityTypeHierarchy", fields: [parentId], references: [id])
  children             EntityType[]           @relation("EntityTypeHierarchy")

  @@map("entity_types")
}

model AttributeGroup {
  id            String         @id @default(uuid()) @db.Uuid
  name          String
  displayName   String         @map("display_name")
  description   String?
  entityTypeId  String         @map("entity_type_id") @db.Uuid
  sortOrder     Int            @default(0) @map("sort_order")
  isCollapsible Boolean        @default(true) @map("is_collapsible")
  isRequired    Boolean        @default(false) @map("is_required")
  createdAt     DateTime       @default(now()) @map("created_at")
  updatedAt     DateTime       @updatedAt @map("updated_at")
  entityType    EntityType     @relation("EntityTypeAttributeGroups", fields: [entityTypeId], references: [id], onDelete: Cascade)
  attributes    EavAttribute[] @relation("AttributeGroupAttributes")

  @@map("attribute_groups")
}

model EavAttribute {
  id                        String                 @id @default(uuid()) @db.Uuid
  name                      String
  displayName               String                 @map("display_name")
  description               String?
  entityTypeId              String                 @map("entity_type_id") @db.Uuid
  attributeGroupId          String?                @map("attribute_group_id") @db.Uuid
  dataType                  String                 @map("data_type")
  cardinality               String                 @default("SINGLE")
  scope                     String                 @default("INSTANCE")
  isRequired                Boolean                @default(false) @map("is_required")
  isUnique                  Boolean                @default(false) @map("is_unique")
  isIndexed                 Boolean                @default(false) @map("is_indexed")
  isSearchable              Boolean                @default(true) @map("is_searchable")
  isAuditable               Boolean                @default(true) @map("is_auditable")
  defaultValue              String?                @map("default_value")
  options                   Json?                  @default("{}")
  validationRules           Json?                  @default("{}") @map("validation_rules")
  sortOrder                 Int                    @default(0) @map("sort_order")
  isVisible                 Boolean                @default(true) @map("is_visible")
  isEditable                Boolean                @default(true) @map("is_editable")
  helpText                  String?                @map("help_text")
  placeholder               String?
  referenceEntityTypeId     String?                @map("reference_entity_type_id") @db.Uuid
  referenceDisplayField     String?                @map("reference_display_field")
  isAutoIncrement           Boolean                @default(false) @map("is_auto_increment")
  autoIncrementPrefix       String                 @default("") @map("auto_increment_prefix")
  autoIncrementSuffix       String                 @default("") @map("auto_increment_suffix")
  autoIncrementStart        Int                    @default(1) @map("auto_increment_start")
  autoIncrementPadding      Int                    @default(3) @map("auto_increment_padding")
  currentAutoIncrementValue Int                    @default(0) @map("current_auto_increment_value")
  externalColumn            String?                @map("external_column")
  externalMapping           Json?                  @default("{}") @map("external_mapping")
  metadata                  Json?                  @default("{}")
  isActive                  Boolean                @default(true) @map("is_active")
  createdAt                 DateTime               @default(now()) @map("created_at")
  updatedAt                 DateTime               @updatedAt @map("updated_at")
  deletedAt                 DateTime?              @map("deleted_at")
  dependencies              AttributeDependency[]  @relation("DependentAttributes")
  dependents                AttributeDependency[]  @relation("DependsOnAttributes")
  inheritances              AttributeInheritance[] @relation("AttributeInheritances")
  attributeGroup            AttributeGroup?        @relation("AttributeGroupAttributes", fields: [attributeGroupId], references: [id])
  entityType                EntityType             @relation("EntityTypeAttributes", fields: [entityTypeId], references: [id], onDelete: Cascade)
  referenceEntityType       EntityType?            @relation("ReferenceEntityType", fields: [referenceEntityTypeId], references: [id])
  values                    EavValue[]             @relation("AttributeValues")

  @@unique([entityTypeId, name])
  @@map("eav_attributes")
}

model EavEntity {
  id           String     @id @default(uuid()) @db.Uuid
  entityTypeId String     @map("entity_type_id") @db.Uuid
  externalId   String?    @map("external_id")
  isActive     Boolean    @default(true) @map("is_active")
  metadata     Json?      @default("{}")
  createdBy    String?    @map("created_by") @db.Uuid
  createdAt    DateTime   @default(now()) @map("created_at")
  updatedAt    DateTime   @updatedAt @map("updated_at")
  deletedAt    DateTime?  @map("deleted_at")
  creator      User?      @relation("EavEntityCreator", fields: [createdBy], references: [id])
  entityType   EntityType @relation("EntityTypeEntities", fields: [entityTypeId], references: [id], onDelete: Cascade)
  values       EavValue[] @relation("EntityValues")

  @@unique([entityTypeId, externalId])
  @@map("eav_entities")
}

model EavValue {
  id            String       @id @default(uuid()) @db.Uuid
  entityId      String       @map("entity_id") @db.Uuid
  attributeId   String       @map("attribute_id") @db.Uuid
  textValue     String?      @map("text_value")
  numberValue   Decimal?     @map("number_value") @db.Decimal(20, 6)
  booleanValue  Boolean?     @map("boolean_value")
  dateValue     DateTime?    @map("date_value") @db.Date
  datetimeValue DateTime?    @map("datetime_value")
  jsonValue     Json?        @map("json_value")
  blobValue     Bytes?       @map("blob_value")
  createdAt     DateTime     @default(now()) @map("created_at")
  updatedAt     DateTime     @updatedAt @map("updated_at")
  attribute     EavAttribute @relation("AttributeValues", fields: [attributeId], references: [id], onDelete: Cascade)
  entity        EavEntity    @relation("EntityValues", fields: [entityId], references: [id], onDelete: Cascade)

  @@unique([entityId, attributeId])
  @@map("eav_values")
}

model AttributeDependency {
  id                   String       @id @default(uuid()) @db.Uuid
  dependentAttributeId String       @map("dependent_attribute_id") @db.Uuid
  dependsOnAttributeId String       @map("depends_on_attribute_id") @db.Uuid
  conditionType        String       @map("condition_type")
  conditionValue       String?      @map("condition_value")
  isActive             Boolean      @default(true) @map("is_active")
  createdAt            DateTime     @default(now()) @map("created_at")
  dependentAttribute   EavAttribute @relation("DependentAttributes", fields: [dependentAttributeId], references: [id], onDelete: Cascade)
  dependsOnAttribute   EavAttribute @relation("DependsOnAttributes", fields: [dependsOnAttributeId], references: [id], onDelete: Cascade)

  @@map("attribute_dependencies")
}

model AttributeInheritance {
  id                 String       @id @default(uuid()) @db.Uuid
  childEntityTypeId  String       @map("child_entity_type_id") @db.Uuid
  parentEntityTypeId String       @map("parent_entity_type_id") @db.Uuid
  attributeId        String       @map("attribute_id") @db.Uuid
  inheritanceType    String       @default("INHERIT") @map("inheritance_type")
  overriddenMetadata Json?        @default("{}") @map("overridden_metadata")
  createdAt          DateTime     @default(now()) @map("created_at")
  attribute          EavAttribute @relation("AttributeInheritances", fields: [attributeId], references: [id], onDelete: Cascade)
  childEntityType    EntityType   @relation("ChildEntityType", fields: [childEntityTypeId], references: [id], onDelete: Cascade)
  parentEntityType   EntityType   @relation("ParentEntityType", fields: [parentEntityTypeId], references: [id], onDelete: Cascade)

  @@unique([childEntityTypeId, attributeId])
  @@map("attribute_inheritance")
}

model EavValueHistory {
  id               String    @id @default(uuid()) @db.Uuid
  entityId         String    @map("entity_id") @db.Uuid
  attributeId      String    @map("attribute_id") @db.Uuid
  oldTextValue     String?   @map("old_text_value")
  oldNumberValue   Decimal?  @map("old_number_value") @db.Decimal(20, 6)
  oldBooleanValue  Boolean?  @map("old_boolean_value")
  oldDateValue     DateTime? @map("old_date_value") @db.Date
  oldDatetimeValue DateTime? @map("old_datetime_value")
  oldJsonValue     Json?     @map("old_json_value")
  oldBlobValue     Bytes?    @map("old_blob_value")
  newTextValue     String?   @map("new_text_value")
  newNumberValue   Decimal?  @map("new_number_value") @db.Decimal(20, 6)
  newBooleanValue  Boolean?  @map("new_boolean_value")
  newDateValue     DateTime? @map("new_date_value") @db.Date
  newDatetimeValue DateTime? @map("new_datetime_value")
  newJsonValue     Json?     @map("new_json_value")
  newBlobValue     Bytes?    @map("new_blob_value")
  changedBy        String?   @map("changed_by") @db.Uuid
  changeReason     String?   @map("change_reason")
  createdAt        DateTime  @default(now()) @map("created_at")

  @@map("eav_value_history")
}

model DataModel {
  id                  String               @id @default(uuid()) @db.Uuid
  name                String
  description         String?
  sortOrder           Int                  @default(0) @map("sort_order")
  isActive            Boolean              @default(true) @map("is_active")
  createdBy           String               @map("created_by") @db.Uuid
  createdAt           DateTime             @default(now()) @map("created_at")
  updatedAt           DateTime             @updatedAt @map("updated_at")
  deletedAt           DateTime?            @map("deleted_at")
  attributes          Attribute[]          @relation("DataModelAttributes")
  spaces              DataModelSpace[]     @relation("DataModelSpaces")
  creator             User                 @relation("DataModelCreator", fields: [createdBy], references: [id])
  dataRecords         DataRecord[]         @relation("DataModelRecords")
  externalConnections ExternalConnection[] @relation("ExternalConnectionDataModels")

  @@map("data_models")
}

model DataModelSpace {
  id          String    @id @default(uuid()) @db.Uuid
  dataModelId String    @map("data_model_id") @db.Uuid
  spaceId     String    @map("space_id") @db.Uuid
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")
  dataModel   DataModel @relation("DataModelSpaces", fields: [dataModelId], references: [id], onDelete: Cascade)
  space       Space     @relation("SpaceDataModels", fields: [spaceId], references: [id], onDelete: Cascade)

  @@unique([dataModelId, spaceId])
  @@map("data_model_spaces")
}

model Attribute {
  id                        String            @id @default(uuid()) @db.Uuid
  name                      String
  displayName               String            @map("display_name")
  type                      String
  description               String?
  isRequired                Boolean           @default(false) @map("is_required")
  isUnique                  Boolean           @default(false) @map("is_unique")
  isPrimaryKey              Boolean?          @default(false) @map("is_primary_key")
  isForeignKey              Boolean?          @default(false) @map("is_foreign_key")
  defaultValue              String?           @map("default_value")
  validationRules           Json?             @map("validation_rules")
  options                   Json?
  order                     Int               @default(0) @map("order")
  isActive                  Boolean           @default(true) @map("is_active")
  deletedAt                 DateTime?         @map("deleted_at")
  dataEntityModelId         String?           @map("data_entity_model_id")
  dataEntityAttributeId     String?           @map("data_entity_attribute_id")
  isAutoIncrement           Boolean           @default(false) @map("is_auto_increment")
  autoIncrementPrefix       String            @default("") @map("auto_increment_prefix")
  autoIncrementSuffix       String            @default("") @map("auto_increment_suffix")
  autoIncrementStart        Int               @default(1) @map("auto_increment_start")
  autoIncrementPadding      Int               @default(3) @map("auto_increment_padding")
  currentAutoIncrementValue Int               @default(0) @map("current_auto_increment_value")
  externalColumn            String?           @map("external_column")
  dataModelId               String            @map("data_model_id") @db.Uuid
  createdAt                 DateTime          @default(now()) @map("created_at")
  updatedAt                 DateTime          @updatedAt @map("updated_at")
  dataModel                 DataModel         @relation("DataModelAttributes", fields: [dataModelId], references: [id], onDelete: Cascade)
  dataRecordValues          DataRecordValue[] @relation("AttributeValues")

  @@map("data_model_attributes")
}

model ExternalConnection {
  id         String      @id @default(uuid()) @db.Uuid
  spaceId    String      @map("space_id") @db.Uuid
  name       String
  dbType     String      @map("db_type")
  host       String
  port       Int?
  database   String?
  username   String
  password   String
  options    Json?
  isActive   Boolean     @default(true) @map("is_active")
  createdAt  DateTime    @default(now()) @map("created_at")
  updatedAt  DateTime    @updatedAt @map("updated_at")
  deletedAt  DateTime?   @map("deleted_at")
  space      Space       @relation("SpaceExternalConnections", fields: [spaceId], references: [id], onDelete: Cascade)
  dataModels DataModel[] @relation("ExternalConnectionDataModels")

  @@map("external_connections")
}

model Team {
  id          String           @id @default(uuid()) @db.Uuid
  name        String
  description String?
  isActive    Boolean          @default(true) @map("is_active")
  createdAt   DateTime         @default(now()) @map("created_at")
  updatedAt   DateTime         @updatedAt @map("updated_at")
  deletedAt   DateTime?        @map("deleted_at")
  members     TeamMember[]     @relation("TeamMembers")
  permissions TeamPermission[] @relation("TeamPermissions")

  @@map("teams")
}

model TeamMember {
  id     String @id @default(uuid()) @db.Uuid
  teamId String @map("team_id") @db.Uuid
  userId String @map("user_id") @db.Uuid
  role   String @default("member")
  team   Team   @relation("TeamMembers", fields: [teamId], references: [id], onDelete: Cascade)
  user   User   @relation("UserTeamMembers", fields: [userId], references: [id], onDelete: Cascade)

  @@unique([teamId, userId])
  @@map("team_members")
}

model Permission {
  id              String           @id @default(uuid()) @db.Uuid
  name            String           @unique
  description     String?
  resource        String
  action          String
  rolePermissions RolePermission[] @relation("PermissionRolePermissions")
  teamPermissions TeamPermission[] @relation("PermissionTeamPermissions")

  @@map("permissions")
}

model TeamPermission {
  id           String     @id @default(uuid()) @db.Uuid
  teamId       String     @map("team_id") @db.Uuid
  permissionId String     @map("permission_id") @db.Uuid
  permission   Permission @relation("PermissionTeamPermissions", fields: [permissionId], references: [id], onDelete: Cascade)
  team         Team       @relation("TeamPermissions", fields: [teamId], references: [id], onDelete: Cascade)

  @@unique([teamId, permissionId])
  @@map("team_permissions")
}

model Role {
  id                 String             @id @default(uuid()) @db.Uuid
  name               String             @unique
  description        String?
  level              String             @default("space")
  isSystem           Boolean            @default(false) @map("is_system")
  report_permissions ReportPermission[]
  permissions        RolePermission[]   @relation("RolePermissions")

  @@map("roles")
}

model RolePermission {
  id           String     @id @default(uuid()) @db.Uuid
  roleId       String     @map("role_id") @db.Uuid
  permissionId String     @map("permission_id") @db.Uuid
  permission   Permission @relation("PermissionRolePermissions", fields: [permissionId], references: [id], onDelete: Cascade)
  role         Role       @relation("RolePermissions", fields: [roleId], references: [id], onDelete: Cascade)

  @@unique([roleId, permissionId])
  @@map("role_permissions")
}

model DataRecord {
  id          String            @id @default(uuid()) @db.Uuid
  dataModelId String            @map("data_model_id") @db.Uuid
  createdBy   String            @map("created_by") @db.Uuid
  createdAt   DateTime          @default(now()) @map("created_at")
  updatedAt   DateTime          @updatedAt @map("updated_at")
  deletedAt   DateTime?         @map("deleted_at")
  values      DataRecordValue[] @relation("RecordValues")
  creator     User              @relation("DataRecordCreator", fields: [createdBy], references: [id])
  dataModel   DataModel         @relation("DataModelRecords", fields: [dataModelId], references: [id], onDelete: Cascade)

  @@map("data_records")
}

model DataRecordValue {
  id           String     @id @default(uuid()) @db.Uuid
  dataRecordId String     @map("data_record_id") @db.Uuid
  attributeId  String     @map("attribute_id") @db.Uuid
  value        String?
  createdAt    DateTime   @default(now()) @map("created_at")
  updatedAt    DateTime   @updatedAt @map("updated_at")
  attribute    Attribute  @relation("AttributeValues", fields: [attributeId], references: [id], onDelete: Cascade)
  dataRecord   DataRecord @relation("RecordValues", fields: [dataRecordId], references: [id], onDelete: Cascade)

  @@unique([dataRecordId, attributeId])
  @@map("data_record_values")
}

model Notification {
  id          String    @id @default(uuid()) @db.Uuid
  userId      String    @map("user_id") @db.Uuid
  type        String
  title       String
  message     String
  priority    String    @default("MEDIUM")
  status      String    @default("UNREAD")
  data        Json?
  actionUrl   String?   @map("action_url")
  actionLabel String?   @map("action_label")
  expiresAt   DateTime? @map("expires_at")
  readAt      DateTime? @map("read_at")
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")
  user        User      @relation("UserNotifications", fields: [userId], references: [id], onDelete: Cascade)

  @@map("notifications")
}

model SystemSetting {
  id        String   @id @default(uuid()) @db.Uuid
  key       String   @unique
  value     String
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("system_settings")
}

model PlatformIntegration {
  id         String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name       String    @db.VarChar(255)
  type       String    @db.VarChar(100)
  status     String?   @default("pending") @db.VarChar(50)
  config     Json      @default("{}")
  isEnabled  Boolean?  @default(true) @map("is_enabled")
  createdAt  DateTime? @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt  DateTime? @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)
  deletedAt  DateTime? @map("deleted_at") @db.Timestamptz(6)
  created_by String?   @db.Uuid
  users      User?     @relation(fields: [created_by], references: [id], onUpdate: NoAction)

  @@index([created_by], map: "idx_platform_integrations_created_by")
  @@index([status], map: "idx_platform_integrations_status")
  @@index([type], map: "idx_platform_integrations_type")
  @@map("platform_integrations")
}

model SpaceAttachmentStorage {
  id        String   @id @default(uuid()) @db.Uuid
  spaceId   String   @map("space_id") @db.Uuid
  fileName  String   @map("file_name")
  filePath  String   @map("file_path")
  fileSize  Int      @map("file_size")
  mimeType  String   @map("mime_type")
  createdAt DateTime @default(now()) @map("created_at")
  space     Space    @relation("SpaceAttachments", fields: [spaceId], references: [id], onDelete: Cascade)

  @@map("space_attachment_storage")
}

model AttachmentFile {
  id        String   @id @default(uuid()) @db.Uuid
  fileName  String   @map("file_name")
  filePath  String   @map("file_path")
  fileSize  Int      @map("file_size")
  mimeType  String   @map("mime_type")
  createdAt DateTime @default(now()) @map("created_at")

  @@map("attachment_files")
}

model CacheInstance {
  id            String       @id @default(uuid()) @db.Uuid
  name          String
  type          String
  host          String
  port          Int
  password      String?
  isActive      Boolean      @default(true) @map("is_active")
  status        String       @default("disconnected")
  lastConnected DateTime?    @map("last_connected")
  createdAt     DateTime     @default(now()) @map("created_at")
  updatedAt     DateTime     @updatedAt @map("updated_at")
  keys          CacheKey[]
  stats         CacheStats[]

  @@map("cache_instances")
}

model KongInstance {
  id            String    @id @default(uuid()) @db.Uuid
  name          String
  adminUrl      String    @map("admin_url")
  adminApiKey   String?   @map("admin_api_key")
  description   String?
  isActive      Boolean   @default(true) @map("is_active")
  status        String    @default("disconnected")
  lastConnected DateTime? @map("last_connected")
  metadata      Json?     @default("{}")
  createdAt     DateTime  @default(now()) @map("created_at")
  updatedAt     DateTime  @updatedAt @map("updated_at")

  @@map("kong_instances")
}

model CacheKey {
  id           String        @id @default(uuid()) @db.Uuid
  instanceId   String        @map("instance_id") @db.Uuid
  key          String
  value        String
  type         String        @default("string")
  size         Int           @default(0)
  ttl          Int?
  hitCount     Int           @default(0) @map("hit_count")
  lastAccessed DateTime?     @map("last_accessed")
  isExpired    Boolean       @default(false) @map("is_expired")
  createdAt    DateTime      @default(now()) @map("created_at")
  updatedAt    DateTime      @updatedAt @map("updated_at")
  instance     CacheInstance @relation(fields: [instanceId], references: [id], onDelete: Cascade)

  @@unique([instanceId, key])
  @@map("cache_keys")
}

model CacheStats {
  id                String        @id @default(uuid()) @db.Uuid
  instanceId        String        @map("instance_id") @db.Uuid
  totalKeys         Int           @default(0) @map("total_keys")
  memoryUsage       BigInt        @default(0) @map("memory_usage")
  hitRate           Float         @default(0) @map("hit_rate")
  missRate          Float         @default(0) @map("miss_rate")
  evictionRate      Float         @default(0) @map("eviction_rate")
  avgResponseTime   Float         @default(0) @map("avg_response_time")
  connections       Int           @default(0)
  commandsPerSecond Int           @default(0) @map("commands_per_second")
  hits              Int           @default(0)
  misses            Int           @default(0)
  evictions         Int           @default(0)
  expired           Int           @default(0)
  createdAt         DateTime      @default(now()) @map("created_at")
  instance          CacheInstance @relation(fields: [instanceId], references: [id], onDelete: Cascade)

  @@map("cache_stats")
}

model CacheConfig {
  id             String   @id @default(uuid()) @db.Uuid
  instanceId     String   @unique @map("instance_id") @db.Uuid
  maxMemory      String   @map("max_memory")
  evictionPolicy String   @map("eviction_policy")
  ttl            Int      @default(3600)
  compression    Boolean  @default(false)
  persistence    Boolean  @default(false)
  clustering     Boolean  @default(false)
  createdAt      DateTime @default(now()) @map("created_at")
  updatedAt      DateTime @updatedAt @map("updated_at")

  @@map("cache_configs")
}

model Notebook {
  id          String    @id @default(uuid()) @db.Uuid
  name        String
  description String?
  content     Json?     @default("{}")
  cells       Json?     @default("[]")
  tags        String[]  @default([])
  isPublic    Boolean   @default(false) @map("is_public")
  author      String
  spaceId     String?   @map("space_id") @db.Uuid
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")
  deletedAt   DateTime? @map("deleted_at")
  space       Space?    @relation("SpaceNotebooks", fields: [spaceId], references: [id], onDelete: Cascade)

  @@map("notebooks")
}

model AIProviderConfig {
  id            String    @id @default(uuid()) @db.Uuid
  provider      String    @unique
  name          String
  description   String?
  website       String?
  icon          String?
  isSupported   Boolean   @default(true) @map("is_supported")
  apiKey        String?   @map("api_key")
  baseUrl       String?   @map("base_url")
  customHeaders Json?     @default("{}") @map("custom_headers")
  timeout       Int       @default(30000)
  retryAttempts Int       @default(3) @map("retry_attempts")
  status        String    @default("inactive")
  isConfigured  Boolean   @default(false) @map("is_configured")
  lastTested    DateTime? @map("last_tested")
  createdAt     DateTime  @default(now()) @map("created_at")
  updatedAt     DateTime  @updatedAt @map("updated_at")

  @@map("ai_provider_configs")
}

model AIModel {
  id           String        @id @default(uuid()) @db.Uuid
  name         String
  provider     String
  type         String
  description  String?
  maxTokens    Int           @map("max_tokens")
  costPerToken Float         @map("cost_per_token")
  isAvailable  Boolean       @default(true) @map("is_available")
  capabilities Json?         @default("[]")
  createdAt    DateTime      @default(now()) @map("created_at")
  updatedAt    DateTime      @updatedAt @map("updated_at")
  chatSessions ChatSession[] @relation("ModelChatSessions")

  @@map("ai_models")
}

model ChatSession {
  id          String    @id @default(uuid()) @db.Uuid
  title       String
  description String?
  isPrivate   Boolean   @default(false) @map("is_private")
  userId      String    @map("user_id") @db.Uuid
  spaceId     String?   @map("space_id") @db.Uuid
  modelId     String?   @map("model_id") @db.Uuid
  messages    Json?     @default("[]")
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")
  deletedAt   DateTime? @map("deleted_at")
  model       AIModel?  @relation("ModelChatSessions", fields: [modelId], references: [id])
  space       Space?    @relation("SpaceChatSessions", fields: [spaceId], references: [id], onDelete: Cascade)
  user        User      @relation("UserChatSessions", fields: [userId], references: [id], onDelete: Cascade)

  @@map("chat_sessions")
}

model AuditLog {
  id         String   @id @default(uuid()) @db.Uuid
  action     String
  entityType String   @map("entity_type")
  entityId   String   @map("entity_id") @db.Uuid
  oldValue   String?  @map("old_value")
  newValue   String?  @map("new_value")
  userId     String?  @map("user_id") @db.Uuid
  ipAddress  String?  @map("ip_address")
  userAgent  String?  @map("user_agent")
  createdAt  DateTime @default(now()) @map("created_at")
  user       User?    @relation("UserAuditLogs", fields: [userId], references: [id])

  @@map("audit_logs")
}

model Project {
  id          String      @id @default(uuid()) @db.Uuid
  name        String
  description String?
  status      String      @default("PLANNING")
  startDate   DateTime?   @map("start_date")
  endDate     DateTime?   @map("end_date")
  spaceId     String      @map("space_id") @db.Uuid
  createdBy   String      @map("created_by") @db.Uuid
  metadata    Json?       @default("{}")
  createdAt   DateTime    @default(now()) @map("created_at")
  updatedAt   DateTime    @updatedAt @map("updated_at")
  deletedAt   DateTime?   @map("deleted_at")
  cycles      Cycle[]     @relation("ProjectCycles")
  milestones  Milestone[] @relation("ProjectMilestones")
  modules     Module[]    @relation("ProjectModules")
  creator     User        @relation("ProjectCreator", fields: [createdBy], references: [id])
  space       Space       @relation("SpaceProjects", fields: [spaceId], references: [id], onDelete: Cascade)
  releases    Release[]   @relation("ProjectReleases")
  tickets     Ticket[]    @relation("ProjectTickets")

  @@map("projects")
}

model Milestone {
  id          String    @id @default(uuid()) @db.Uuid
  projectId   String    @map("project_id") @db.Uuid
  name        String
  description String?
  status      String    @default("UPCOMING")
  startDate   DateTime? @map("start_date")
  dueDate     DateTime? @map("due_date")
  completedAt DateTime? @map("completed_at")
  createdBy   String    @map("created_by") @db.Uuid
  metadata    Json?     @default("{}")
  position    Int       @default(0)
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")
  deletedAt   DateTime? @map("deleted_at")
  creator     User      @relation("MilestoneCreator", fields: [createdBy], references: [id])
  project     Project   @relation("ProjectMilestones", fields: [projectId], references: [id], onDelete: Cascade)
  tickets     Ticket[]  @relation("MilestoneTickets")

  @@map("milestones")
}

model Release {
  id          String    @id @default(uuid()) @db.Uuid
  projectId   String    @map("project_id") @db.Uuid
  name        String
  version     String?
  description String?
  status      String    @default("PLANNED")
  releaseDate DateTime? @map("release_date")
  targetDate  DateTime? @map("target_date")
  createdBy   String    @map("created_by") @db.Uuid
  metadata    Json?     @default("{}")
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")
  deletedAt   DateTime? @map("deleted_at")
  creator     User      @relation("ReleaseCreator", fields: [createdBy], references: [id])
  project     Project   @relation("ProjectReleases", fields: [projectId], references: [id], onDelete: Cascade)
  tickets     Ticket[]  @relation("ReleaseTickets")

  @@index([projectId, version])
  @@map("releases")
}

model Module {
  id          String    @id @default(uuid()) @db.Uuid
  projectId   String    @map("project_id") @db.Uuid
  name        String
  description String?
  status      String    @default("PLANNED")
  startDate   DateTime? @map("start_date")
  targetDate  DateTime? @map("target_date")
  completedAt DateTime? @map("completed_at")
  leadId      String?   @map("lead_id") @db.Uuid
  createdBy   String    @map("created_by") @db.Uuid
  metadata    Json?     @default("{}")
  position    Int       @default(0)
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")
  deletedAt   DateTime? @map("deleted_at")
  creator     User      @relation("ModuleCreator", fields: [createdBy], references: [id])
  lead        User?     @relation("ModuleLead", fields: [leadId], references: [id])
  project     Project   @relation("ProjectModules", fields: [projectId], references: [id], onDelete: Cascade)
  tickets     Ticket[]  @relation("ModuleTickets")

  @@map("modules")
}

model Cycle {
  id          String    @id @default(uuid()) @db.Uuid
  projectId   String    @map("project_id") @db.Uuid
  name        String
  description String?
  status      String    @default("DRAFT")
  startDate   DateTime? @map("start_date")
  endDate     DateTime? @map("end_date")
  completedAt DateTime? @map("completed_at")
  createdBy   String    @map("created_by") @db.Uuid
  metadata    Json?     @default("{}")
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")
  deletedAt   DateTime? @map("deleted_at")
  creator     User      @relation("CycleCreator", fields: [createdBy], references: [id])
  project     Project   @relation("ProjectCycles", fields: [projectId], references: [id], onDelete: Cascade)
  tickets     Ticket[]  @relation("CycleTickets")

  @@map("cycles")
}

model Ticket {
  id           String             @id @default(uuid()) @db.Uuid
  title        String
  description  String?
  status       String             @default("BACKLOG")
  priority     String             @default("MEDIUM")
  dueDate      DateTime?          @map("due_date")
  startDate    DateTime?          @map("start_date")
  completedAt  DateTime?          @map("completed_at")
  createdBy    String             @map("created_by") @db.Uuid
  estimate     Int?
  metadata     Json?              @default("{}")
  parentId     String?            @map("parent_id") @db.Uuid
  projectId    String?            @map("project_id") @db.Uuid
  milestoneId  String?            @map("milestone_id") @db.Uuid
  releaseId    String?            @map("release_id") @db.Uuid
  moduleId     String?            @map("module_id") @db.Uuid
  cycleId      String?            @map("cycle_id") @db.Uuid
  type         String             @default("ISSUE")
  position     Int                @default(0)
  createdAt    DateTime           @default(now()) @map("created_at")
  updatedAt    DateTime           @updatedAt @map("updated_at")
  deletedAt    DateTime?          @map("deleted_at")
  assignees    TicketAssignee[]   @relation("TicketAssignees")
  attachments  TicketAttachment[] @relation("TicketAttachments")
  attributes   TicketAttribute[]  @relation("TicketAttributes")
  comments     TicketComment[]    @relation("TicketComments")
  dependents   TicketDependency[] @relation("TicketDependents")
  dependencies TicketDependency[] @relation("TicketDependencies")
  spaces       TicketSpace[]      @relation("TicketSpaces")
  tags         TicketTag[]        @relation("TicketTags")
  timeLogs     TicketTimeLog[]    @relation("TicketTimeLogs")
  creator      User               @relation("TicketCreator", fields: [createdBy], references: [id])
  cycle        Cycle?             @relation("CycleTickets", fields: [cycleId], references: [id])
  milestone    Milestone?         @relation("MilestoneTickets", fields: [milestoneId], references: [id])
  module       Module?            @relation("ModuleTickets", fields: [moduleId], references: [id])
  parent       Ticket?            @relation("TicketSubtasks", fields: [parentId], references: [id])
  subtasks     Ticket[]           @relation("TicketSubtasks")
  project      Project?           @relation("ProjectTickets", fields: [projectId], references: [id])
  release      Release?           @relation("ReleaseTickets", fields: [releaseId], references: [id])

  @@map("tickets")
}

model TicketSpace {
  id        String   @id @default(uuid()) @db.Uuid
  ticketId  String   @map("ticket_id") @db.Uuid
  spaceId   String   @map("space_id") @db.Uuid
  createdAt DateTime @default(now()) @map("created_at")
  space     Space    @relation("SpaceTicketSpaces", fields: [spaceId], references: [id], onDelete: Cascade)
  ticket    Ticket   @relation("TicketSpaces", fields: [ticketId], references: [id], onDelete: Cascade)

  @@unique([ticketId, spaceId])
  @@map("ticket_spaces")
}

model TicketAssignee {
  id        String   @id @default(uuid()) @db.Uuid
  ticketId  String   @map("ticket_id") @db.Uuid
  userId    String   @map("user_id") @db.Uuid
  role      String   @default("ASSIGNEE")
  createdAt DateTime @default(now()) @map("created_at")
  ticket    Ticket   @relation("TicketAssignees", fields: [ticketId], references: [id], onDelete: Cascade)
  user      User     @relation("TicketAssignees", fields: [userId], references: [id], onDelete: Cascade)

  @@unique([ticketId, userId])
  @@map("ticket_assignees")
}

model TicketTag {
  id        String   @id @default(uuid()) @db.Uuid
  ticketId  String   @map("ticket_id") @db.Uuid
  name      String
  color     String?
  createdAt DateTime @default(now()) @map("created_at")
  ticket    Ticket   @relation("TicketTags", fields: [ticketId], references: [id], onDelete: Cascade)

  @@unique([ticketId, name])
  @@map("ticket_tags")
}

model TicketAttribute {
  id          String   @id @default(uuid()) @db.Uuid
  ticketId    String   @map("ticket_id") @db.Uuid
  name        String
  displayName String   @map("display_name")
  type        String
  value       String?
  jsonValue   Json?    @map("json_value")
  isRequired  Boolean  @default(false) @map("is_required")
  sortOrder   Int      @default(0) @map("sort_order")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")
  ticket      Ticket   @relation("TicketAttributes", fields: [ticketId], references: [id], onDelete: Cascade)

  @@unique([ticketId, name])
  @@map("ticket_attributes")
}

model TicketComment {
  id        String    @id @default(uuid()) @db.Uuid
  ticketId  String    @map("ticket_id") @db.Uuid
  userId    String    @map("user_id") @db.Uuid
  content   String
  metadata  Json?     @default("{}")
  createdAt DateTime  @default(now()) @map("created_at")
  updatedAt DateTime  @updatedAt @map("updated_at")
  deletedAt DateTime? @map("deleted_at")
  ticket    Ticket    @relation("TicketComments", fields: [ticketId], references: [id], onDelete: Cascade)
  author    User      @relation("TicketCommentAuthor", fields: [userId], references: [id])

  @@map("ticket_comments")
}

model TicketAttachment {
  id         String   @id @default(uuid()) @db.Uuid
  ticketId   String   @map("ticket_id") @db.Uuid
  fileName   String   @map("file_name")
  filePath   String   @map("file_path")
  fileSize   Int      @map("file_size")
  mimeType   String   @map("mime_type")
  uploadedBy String?  @map("uploaded_by") @db.Uuid
  createdAt  DateTime @default(now()) @map("created_at")
  ticket     Ticket   @relation("TicketAttachments", fields: [ticketId], references: [id], onDelete: Cascade)

  @@map("ticket_attachments")
}

model TicketTimeLog {
  id          String   @id @default(uuid()) @db.Uuid
  ticketId    String   @map("ticket_id") @db.Uuid
  userId      String   @map("user_id") @db.Uuid
  description String?
  hours       Decimal  @db.Decimal(10, 2)
  loggedAt    DateTime @map("logged_at")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")
  ticket      Ticket   @relation("TicketTimeLogs", fields: [ticketId], references: [id], onDelete: Cascade)
  user        User     @relation("TicketTimeLogUser", fields: [userId], references: [id])

  @@map("ticket_time_logs")
}

model TicketDependency {
  id          String   @id @default(uuid()) @db.Uuid
  ticketId    String   @map("ticket_id") @db.Uuid
  dependsOnId String   @map("depends_on_id") @db.Uuid
  type        String   @default("BLOCKS")
  metadata    Json?    @default("{}")
  createdAt   DateTime @default(now()) @map("created_at")
  dependsOn   Ticket   @relation("TicketDependents", fields: [dependsOnId], references: [id], onDelete: Cascade)
  ticket      Ticket   @relation("TicketDependencies", fields: [ticketId], references: [id], onDelete: Cascade)

  @@unique([ticketId, dependsOnId])
  @@map("ticket_dependencies")
}

model KanbanConfig {
  id          String   @id @default(uuid()) @db.Uuid
  spaceId     String   @map("space_id") @db.Uuid
  name        String
  description String?
  config      Json
  isDefault   Boolean  @default(false) @map("is_default")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")
  space       Space    @relation("SpaceKanbanConfigs", fields: [spaceId], references: [id], onDelete: Cascade)

  @@map("kanban_configs")
}

model IntakeForm {
  id          String             @id @default(uuid()) @db.Uuid
  spaceId     String             @map("space_id") @db.Uuid
  name        String
  description String?
  formFields  Json               @map("form_fields")
  workflow    Json?
  isActive    Boolean            @default(true) @map("is_active")
  createdAt   DateTime           @default(now()) @map("created_at")
  updatedAt   DateTime           @updatedAt @map("updated_at")
  space       Space              @relation("SpaceIntakeForms", fields: [spaceId], references: [id], onDelete: Cascade)
  submissions IntakeSubmission[] @relation("IntakeFormSubmissions")

  @@map("intake_forms")
}

model IntakeSubmission {
  id        String     @id @default(uuid()) @db.Uuid
  formId    String     @map("form_id") @db.Uuid
  userId    String?    @map("user_id") @db.Uuid
  data      Json
  ticketId  String?    @map("ticket_id") @db.Uuid
  status    String     @default("PENDING")
  createdAt DateTime   @default(now()) @map("created_at")
  updatedAt DateTime   @updatedAt @map("updated_at")
  form      IntakeForm @relation("IntakeFormSubmissions", fields: [formId], references: [id], onDelete: Cascade)
  user      User?      @relation("IntakeSubmissionUser", fields: [userId], references: [id])

  @@map("intake_submissions")
}

model ImportProfile {
  id          String      @id @default(uuid()) @db.Uuid
  name        String
  description String?
  dataModelId String      @map("data_model_id") @db.Uuid
  mapping     Json        @default("{}")
  settings    Json        @default("{}")
  createdBy   String      @map("created_by") @db.Uuid
  spaceId     String?     @map("space_id") @db.Uuid
  createdAt   DateTime    @default(now()) @map("created_at")
  updatedAt   DateTime    @updatedAt @map("updated_at")
  deletedAt   DateTime?   @map("deleted_at")
  jobs        ImportJob[] @relation("ImportProfileJobs")
  creator     User        @relation("ImportProfileCreator", fields: [createdBy], references: [id])
  space       Space?      @relation("SpaceImportProfiles", fields: [spaceId], references: [id])

  @@map("import_profiles")
}

model ImportJob {
  id            String         @id @default(uuid()) @db.Uuid
  profileId     String?        @map("profile_id") @db.Uuid
  dataModelId   String         @map("data_model_id") @db.Uuid
  fileName      String         @map("file_name")
  fileSize      Int            @map("file_size")
  fileType      String         @map("file_type")
  status        String         @default("PENDING")
  progress      Int            @default(0)
  totalRows     Int?           @map("total_rows")
  processedRows Int            @default(0) @map("processed_rows")
  errorMessage  String?        @map("error_message")
  result        Json?
  mapping       Json           @default("{}")
  createdBy     String         @map("created_by") @db.Uuid
  spaceId       String?        @map("space_id") @db.Uuid
  startedAt     DateTime?      @map("started_at")
  completedAt   DateTime?      @map("completed_at")
  createdAt     DateTime       @default(now()) @map("created_at")
  updatedAt     DateTime       @updatedAt @map("updated_at")
  creator       User           @relation("ImportJobCreator", fields: [createdBy], references: [id])
  profile       ImportProfile? @relation("ImportProfileJobs", fields: [profileId], references: [id])
  space         Space?         @relation("SpaceImportJobs", fields: [spaceId], references: [id])

  @@map("import_jobs")
}

model ExportJob {
  id            String    @id @default(uuid()) @db.Uuid
  dataModelId   String    @map("data_model_id") @db.Uuid
  format        String    @default("xlsx")
  status        String    @default("PENDING")
  progress      Int       @default(0)
  totalRows     Int?      @map("total_rows")
  processedRows Int       @default(0) @map("processed_rows")
  errorMessage  String?   @map("error_message")
  fileUrl       String?   @map("file_url")
  fileName      String?   @map("file_name")
  fileSize      Int?      @map("file_size")
  filters       Json      @default("{}")
  columns       Json      @default("[]")
  createdBy     String    @map("created_by") @db.Uuid
  spaceId       String?   @map("space_id") @db.Uuid
  startedAt     DateTime? @map("started_at")
  completedAt   DateTime? @map("completed_at")
  createdAt     DateTime  @default(now()) @map("created_at")
  updatedAt     DateTime  @updatedAt @map("updated_at")
  creator       User      @relation("ExportJobCreator", fields: [createdBy], references: [id])
  space         Space?    @relation("SpaceExportJobs", fields: [spaceId], references: [id])

  @@map("export_jobs")
}

model Chatbot {
  id                    String                     @id @default(uuid()) @db.Uuid
  name                  String
  website               String?
  description           String?
  apiEndpoint           String                     @map("api_endpoint")
  apiAuthType           String                     @default("none") @map("api_auth_type")
  apiAuthValue          String?                    @map("api_auth_value")
  logo                  String?
  primaryColor          String?                    @map("primary_color")
  fontFamily            String?                    @map("font_family")
  fontSize              String?                    @map("font_size")
  fontColor             String?                    @map("font_color")
  borderColor           String?                    @map("border_color")
  borderWidth           String?                    @map("border_width")
  borderRadius          String?                    @map("border_radius")
  messageBoxColor       String?                    @map("message_box_color")
  widgetBackgroundColor String?                    @map("widget_background_color")
  shadowColor           String?                    @map("shadow_color")
  shadowBlur            String?                    @map("shadow_blur")
  conversationOpener    String?                    @map("conversation_opener")
  followUpQuestions     Json                       @default("[]") @map("follow_up_questions")
  enableFileUpload      Boolean                    @default(false) @map("enable_file_upload")
  showCitations         Boolean                    @default(true) @map("show_citations")
  deploymentType        String                     @default("popover") @map("deployment_type")
  engineType            String                     @default("chatkit") @map("engine_type")
  customEmbedDomain     String?                    @map("custom_embed_domain")
  domainAllowlist       String?                    @map("domain_allowlist")
  isPublished           Boolean                    @default(false) @map("is_published")
  currentVersion        String?                    @map("current_version")
  createdBy             String                     @map("created_by") @db.Uuid
  spaceId               String?                    @map("space_id") @db.Uuid
  createdAt             DateTime                   @default(now()) @map("created_at")
  updatedAt             DateTime                   @updatedAt @map("updated_at")
  deletedAt             DateTime?                  @map("deleted_at")
  agentLoopConfig       ChatbotAgentLoopConfig?    @relation("ChatbotAgentLoopConfigs")
  cacheConfig           ChatbotCacheConfig?        @relation("ChatbotCacheConfigs")
  connectors            ChatbotConnector[]         @relation("ChatbotConnectors")
  costBudget            ChatbotCostBudget?         @relation("ChatbotCostBudgets")
  costRecords           ChatbotCostRecord[]        @relation("ChatbotCostRecords")
  customFunctions       ChatbotCustomFunction[]    @relation("ChatbotCustomFunctions")
  lifecycleHooks        ChatbotLifecycleHook[]     @relation("ChatbotLifecycleHooks")
  multiAgentConfig      ChatbotMultiAgentConfig?   @relation("ChatbotMultiAgentConfigs")
  performanceMetrics    ChatbotPerformanceMetric[] @relation("ChatbotPerformanceMetrics")
  rateLimit             ChatbotRateLimit?          @relation("ChatbotRateLimits")
  retryConfig           ChatbotRetryConfig?        @relation("ChatbotRetryConfigs")
  versions              ChatbotVersion[]           @relation("ChatbotVersions")
  webhooks              ChatbotWebhook[]           @relation("ChatbotWebhooks")
  creator               User                       @relation("ChatbotCreator", fields: [createdBy], references: [id])
  space                 Space?                     @relation("SpaceChatbots", fields: [spaceId], references: [id])
  threads               OpenAIAgentThread[]        @relation("ChatbotThreads")

  @@map("chatbots")
}

model ChatbotVersion {
  id          String   @id @default(uuid()) @db.Uuid
  chatbotId   String   @map("chatbot_id") @db.Uuid
  version     String
  config      Json     @default("{}")
  isPublished Boolean  @default(false) @map("is_published")
  createdBy   String   @map("created_by") @db.Uuid
  createdAt   DateTime @default(now()) @map("created_at")
  chatbot     Chatbot  @relation("ChatbotVersions", fields: [chatbotId], references: [id], onDelete: Cascade)
  creator     User     @relation("ChatbotVersionCreator", fields: [createdBy], references: [id])

  @@map("chatbot_versions")
}

model OpenAIAgentThread {
  id            String    @id @default(uuid()) @db.Uuid
  threadId      String    @unique @map("thread_id")
  chatbotId     String    @map("chatbot_id") @db.Uuid
  userId        String?   @map("user_id") @db.Uuid
  spaceId       String?   @map("space_id") @db.Uuid
  title         String?
  metadata      Json?     @default("{}")
  messageCount  Int       @default(0) @map("message_count")
  lastMessageAt DateTime? @map("last_message_at")
  createdAt     DateTime  @default(now()) @map("created_at")
  updatedAt     DateTime  @updatedAt @map("updated_at")
  deletedAt     DateTime? @map("deleted_at")
  chatbot       Chatbot   @relation("ChatbotThreads", fields: [chatbotId], references: [id], onDelete: Cascade)
  space         Space?    @relation("SpaceAgentThreads", fields: [spaceId], references: [id], onDelete: Cascade)
  user          User?     @relation("UserAgentThreads", fields: [userId], references: [id])

  @@index([chatbotId, userId])
  @@index([threadId])
  @@map("openai_agent_threads")
}

model ChatbotRateLimit {
  id                   String   @id @default(uuid()) @db.Uuid
  chatbotId            String   @unique @map("chatbot_id") @db.Uuid
  enabled              Boolean  @default(true)
  maxRequestsPerMinute Int?     @map("max_requests_per_minute")
  maxRequestsPerHour   Int?     @map("max_requests_per_hour")
  maxRequestsPerDay    Int?     @map("max_requests_per_day")
  maxRequestsPerMonth  Int?     @map("max_requests_per_month")
  burstLimit           Int?     @map("burst_limit")
  windowSize           Int?     @default(60) @map("window_size")
  blockDuration        Int?     @default(300) @map("block_duration")
  createdAt            DateTime @default(now()) @map("created_at")
  updatedAt            DateTime @updatedAt @map("updated_at")
  chatbot              Chatbot  @relation("ChatbotRateLimits", fields: [chatbotId], references: [id], onDelete: Cascade)

  @@map("chatbot_rate_limits")
}

model ChatbotCacheConfig {
  id             String   @id @default(uuid()) @db.Uuid
  chatbotId      String   @unique @map("chatbot_id") @db.Uuid
  enabled        Boolean  @default(true)
  ttl            Int      @default(3600)
  maxSize        Int      @default(1000) @map("max_size")
  strategy       String   @default("exact")
  includeContext Boolean  @default(false) @map("include_context")
  cacheKeyPrefix String?  @map("cache_key_prefix")
  createdAt      DateTime @default(now()) @map("created_at")
  updatedAt      DateTime @updatedAt @map("updated_at")
  chatbot        Chatbot  @relation("ChatbotCacheConfigs", fields: [chatbotId], references: [id], onDelete: Cascade)

  @@map("chatbot_cache_configs")
}

model ChatbotRetryConfig {
  id                   String   @id @default(uuid()) @db.Uuid
  chatbotId            String   @unique @map("chatbot_id") @db.Uuid
  enabled              Boolean  @default(true)
  maxRetries           Int      @default(3) @map("max_retries")
  initialDelay         Int      @default(1000) @map("initial_delay")
  maxDelay             Int      @default(30000) @map("max_delay")
  backoffMultiplier    Float    @default(2.0) @map("backoff_multiplier")
  retryableStatusCodes String[] @default(["500", "502", "503", "504"]) @map("retryable_status_codes")
  jitter               Boolean  @default(true)
  createdAt            DateTime @default(now()) @map("created_at")
  updatedAt            DateTime @updatedAt @map("updated_at")
  chatbot              Chatbot  @relation("ChatbotRetryConfigs", fields: [chatbotId], references: [id], onDelete: Cascade)

  @@map("chatbot_retry_configs")
}

model ChatbotCostBudget {
  id             String   @id @default(uuid()) @db.Uuid
  chatbotId      String   @unique @map("chatbot_id") @db.Uuid
  enabled        Boolean  @default(true)
  monthlyBudget  Decimal? @map("monthly_budget") @db.Decimal(10, 2)
  dailyBudget    Decimal? @map("daily_budget") @db.Decimal(10, 2)
  alertThreshold Float    @default(0.8) @map("alert_threshold")
  alertEmail     String?  @map("alert_email")
  trackPerUser   Boolean  @default(false) @map("track_per_user")
  trackPerThread Boolean  @default(false) @map("track_per_thread")
  createdAt      DateTime @default(now()) @map("created_at")
  updatedAt      DateTime @updatedAt @map("updated_at")
  chatbot        Chatbot  @relation("ChatbotCostBudgets", fields: [chatbotId], references: [id], onDelete: Cascade)

  @@map("chatbot_cost_budgets")
}

model ChatbotCostRecord {
  id           String   @id @default(uuid()) @db.Uuid
  chatbotId    String   @map("chatbot_id") @db.Uuid
  userId       String?  @map("user_id") @db.Uuid
  threadId     String?  @map("thread_id")
  traceId      String?  @map("trace_id")
  cost         Decimal  @db.Decimal(10, 6)
  inputTokens  Int?     @map("input_tokens")
  outputTokens Int?     @map("output_tokens")
  totalTokens  Int?     @map("total_tokens")
  model        String?
  metadata     Json?    @default("{}")
  recordedAt   DateTime @default(now()) @map("recorded_at")
  chatbot      Chatbot  @relation("ChatbotCostRecords", fields: [chatbotId], references: [id], onDelete: Cascade)
  user         User?    @relation("UserCostRecords", fields: [userId], references: [id])

  @@index([chatbotId, recordedAt])
  @@index([userId, recordedAt])
  @@index([threadId])
  @@map("chatbot_cost_records")
}

model ChatbotWebhook {
  id        String   @id @default(uuid()) @db.Uuid
  chatbotId String   @map("chatbot_id") @db.Uuid
  url       String
  secret    String?
  events    String[]
  enabled   Boolean  @default(true)
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  chatbot   Chatbot  @relation("ChatbotWebhooks", fields: [chatbotId], references: [id], onDelete: Cascade)

  @@index([chatbotId])
  @@map("chatbot_webhooks")
}

model ChatbotPerformanceMetric {
  id         String   @id @default(uuid()) @db.Uuid
  chatbotId  String   @map("chatbot_id") @db.Uuid
  metricType String   @map("metric_type")
  value      Decimal  @db.Decimal(10, 4)
  metadata   Json?    @default("{}")
  recordedAt DateTime @default(now()) @map("recorded_at")
  chatbot    Chatbot  @relation("ChatbotPerformanceMetrics", fields: [chatbotId], references: [id], onDelete: Cascade)

  @@index([chatbotId, metricType, recordedAt])
  @@index([recordedAt])
  @@map("chatbot_performance_metrics")
}

model ChatbotCustomFunction {
  id            String   @id @default(uuid()) @db.Uuid
  chatbotId     String   @map("chatbot_id") @db.Uuid
  name          String
  description   String
  parameters    Json
  endpoint      String?
  code          String?
  executionType String   @map("execution_type")
  enabled       Boolean  @default(true)
  metadata      Json?    @default("{}")
  createdAt     DateTime @default(now()) @map("created_at")
  updatedAt     DateTime @updatedAt @map("updated_at")
  chatbot       Chatbot  @relation("ChatbotCustomFunctions", fields: [chatbotId], references: [id], onDelete: Cascade)

  @@index([chatbotId])
  @@map("chatbot_custom_functions")
}

model ChatbotMultiAgentConfig {
  id                   String   @id @default(uuid()) @db.Uuid
  chatbotId            String   @unique @map("chatbot_id") @db.Uuid
  enabled              Boolean  @default(false)
  agents               Json
  handoffRules         Json?    @default("{}") @map("handoff_rules")
  coordinationStrategy String?  @map("coordination_strategy")
  metadata             Json?    @default("{}")
  createdAt            DateTime @default(now()) @map("created_at")
  updatedAt            DateTime @updatedAt @map("updated_at")
  chatbot              Chatbot  @relation("ChatbotMultiAgentConfigs", fields: [chatbotId], references: [id], onDelete: Cascade)

  @@map("chatbot_multi_agent_configs")
}

model ChatbotLifecycleHook {
  id          String   @id @default(uuid()) @db.Uuid
  chatbotId   String   @map("chatbot_id") @db.Uuid
  hookType    String   @map("hook_type")
  enabled     Boolean  @default(true)
  handlerType String   @map("handler_type")
  handlerUrl  String?  @map("handler_url")
  handlerCode String?  @map("handler_code")
  metadata    Json?    @default("{}")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")
  chatbot     Chatbot  @relation("ChatbotLifecycleHooks", fields: [chatbotId], references: [id], onDelete: Cascade)

  @@index([chatbotId, hookType])
  @@map("chatbot_lifecycle_hooks")
}

model ChatbotConnector {
  id            String   @id @default(uuid()) @db.Uuid
  chatbotId     String   @map("chatbot_id") @db.Uuid
  connectorType String   @map("connector_type")
  enabled       Boolean  @default(true)
  credentials   Json?
  config        Json?    @default("{}")
  metadata      Json?    @default("{}")
  createdAt     DateTime @default(now()) @map("created_at")
  updatedAt     DateTime @updatedAt @map("updated_at")
  chatbot       Chatbot  @relation("ChatbotConnectors", fields: [chatbotId], references: [id], onDelete: Cascade)

  @@index([chatbotId, connectorType])
  @@map("chatbot_connectors")
}

model ChatbotAgentLoopConfig {
  id                String   @id @default(uuid()) @db.Uuid
  chatbotId         String   @unique @map("chatbot_id") @db.Uuid
  maxIterations     Int?     @map("max_iterations")
  stopConditions    Json?    @default("{}") @map("stop_conditions")
  timeout           Int?
  enableHumanInLoop Boolean  @default(false) @map("enable_human_in_loop")
  humanInLoopConfig Json?    @default("{}") @map("human_in_loop_config")
  metadata          Json?    @default("{}")
  createdAt         DateTime @default(now()) @map("created_at")
  updatedAt         DateTime @updatedAt @map("updated_at")
  chatbot           Chatbot  @relation("ChatbotAgentLoopConfigs", fields: [chatbotId], references: [id], onDelete: Cascade)

  @@map("chatbot_agent_loop_configs")
}

model Language {
  id            String         @id @default(uuid()) @db.Uuid
  code          String         @unique
  name          String
  nativeName    String         @map("native_name")
  flag          String?
  isActive      Boolean        @default(true) @map("is_active")
  isDefault     Boolean        @default(false) @map("is_default")
  sortOrder     Int            @default(0) @map("sort_order")
  createdAt     DateTime       @default(now()) @map("created_at")
  updatedAt     DateTime       @updatedAt @map("updated_at")
  localizations Localization[] @relation("LanguageLocalizations")

  @@map("languages")
}

model AssetType {
  id          String    @id @default(uuid()) @db.Uuid
  code        String    @unique
  name        String
  description String?
  category    String
  isActive    Boolean   @default(true) @map("is_active")
  isSystem    Boolean   @default(false) @map("is_system")
  sortOrder   Int       @default(0) @map("sort_order")
  metadata    Json?     @default("{}")
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")
  deletedAt   DateTime? @map("deleted_at")
  assets      Asset[]   @relation("AssetTypeAssets")

  @@map("asset_types")
}

model Asset {
  id          String    @id @default(uuid()) @db.Uuid
  assetTypeId String    @map("asset_type_id") @db.Uuid
  code        String
  name        String
  description String?
  logo        String?
  icon        String?
  color       String?
  isActive    Boolean   @default(true) @map("is_active")
  isSystem    Boolean   @default(false) @map("is_system")
  sortOrder   Int       @default(0) @map("sort_order")
  metadata    Json?     @default("{}")
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")
  deletedAt   DateTime? @map("deleted_at")
  assetType   AssetType @relation("AssetTypeAssets", fields: [assetTypeId], references: [id], onDelete: Cascade)

  @@unique([assetTypeId, code])
  @@map("assets")
}

model Localization {
  id         String   @id @default(uuid()) @db.Uuid
  languageId String   @map("language_id") @db.Uuid
  entityType String   @map("entity_type")
  entityId   String   @map("entity_id") @db.Uuid
  field      String
  value      String
  createdAt  DateTime @default(now()) @map("created_at")
  updatedAt  DateTime @updatedAt @map("updated_at")
  language   Language @relation("LanguageLocalizations", fields: [languageId], references: [id], onDelete: Cascade)

  @@unique([languageId, entityType, entityId, field])
  @@index([entityType, entityId])
  @@map("localizations")
}

model StorageConnection {
  id          String    @id @default(uuid()) @db.Uuid
  name        String
  type        String
  config      Json
  isActive    Boolean   @default(true) @map("is_active")
  status      String    @default("disconnected")
  lastTested  DateTime? @map("last_tested")
  lastError   String?   @map("last_error")
  description String?
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")

  @@map("storage_connections")
}

model ServiceRegistry {
  id                    String                        @id @default(uuid()) @db.Uuid
  name                  String
  slug                  String                        @unique
  description           String?
  version               String
  provider              String
  providerUrl           String?                       @map("provider_url")
  category              String?
  status                String                        @default("pending")
  capabilities          Json?                         @default("{}")
  apiBaseUrl            String?                       @map("api_base_url")
  apiAuthType           String?                       @map("api_auth_type")
  apiAuthConfig         Json?                         @default("{}") @map("api_auth_config")
  uiType                String?                       @map("ui_type")
  uiConfig              Json?                         @default("{}") @map("ui_config")
  webhookSupported      Boolean                       @default(false) @map("webhook_supported")
  webhookEvents         String[]                      @map("webhook_events")
  iconUrl               String?                       @map("icon_url")
  screenshots           String[]
  documentationUrl      String?                       @map("documentation_url")
  supportUrl            String?                       @map("support_url")
  pricingInfo           Json?                         @map("pricing_info")
  installationCount     Int                           @default(0) @map("installation_count")
  rating                Decimal?                      @db.Decimal(3, 2)
  reviewCount           Int                           @default(0) @map("review_count")
  verified              Boolean                       @default(false)
  securityAudit         Json?                         @map("security_audit")
  createdAt             DateTime                      @default(now()) @map("created_at")
  updatedAt             DateTime                      @updatedAt @map("updated_at")
  deletedAt             DateTime?                     @map("deleted_at")
  managementPlugins     InstanceService[]             @relation("ServiceRegistryManagementPlugins")
  menuItems             MenuItem[]                    @relation("PluginMenuItems")
  reviews               PluginReview[]                @relation("ServiceRegistryReviews")
  apiRoutes             ServiceAPIRoute[]             @relation("ServiceRegistryAPIRoutes")
  installations         ServiceInstallation[]         @relation("ServiceRegistryInstallations")
  managementAssignments ServiceManagementAssignment[] @relation("ServiceRegistryManagementAssignments")
  uiComponents          ServiceUIComponent[]          @relation("ServiceRegistryUIComponents")

  @@index([category])
  @@index([status])
  @@index([verified])
  @@map("service_registry")
}

model ServiceInstallation {
  id              String               @id @default(uuid()) @db.Uuid
  serviceId       String               @map("service_id") @db.Uuid
  spaceId         String?              @map("space_id") @db.Uuid
  installedBy     String?              @map("installed_by") @db.Uuid
  config          Json?                @default("{}")
  credentials     Json?                @default("{}")
  status          String               @default("active")
  lastHealthCheck DateTime?            @map("last_health_check")
  healthStatus    String?              @map("health_status")
  permissions     Json?                @default("{}")
  dbSchema        String?              @map("db_schema")
  installedAt     DateTime             @default(now()) @map("installed_at")
  updatedAt       DateTime             @updatedAt @map("updated_at")
  deletedAt       DateTime?            @map("deleted_at")
  apiRoutes       ServiceAPIRoute[]    @relation("ServiceInstallationAPIRoutes")
  installer       User?                @relation("UserServiceInstallations", fields: [installedBy], references: [id])
  service         ServiceRegistry      @relation("ServiceRegistryInstallations", fields: [serviceId], references: [id], onDelete: Cascade)
  space           Space?               @relation("SpaceServiceInstallations", fields: [spaceId], references: [id], onDelete: Cascade)
  uiComponents    ServiceUIComponent[] @relation("ServiceInstallationUIComponents")

  @@unique([serviceId, spaceId])
  @@index([spaceId])
  @@index([serviceId])
  @@index([status])
  @@map("service_installations")
}

model ServiceUIComponent {
  id                  String               @id @default(uuid()) @db.Uuid
  serviceId           String               @map("service_id") @db.Uuid
  installationId      String?              @map("installation_id") @db.Uuid
  componentType       String?              @map("component_type")
  componentName       String?              @map("component_name")
  componentId         String?              @map("component_id")
  renderType          String?              @map("render_type")
  renderConfig        Json?                @default("{}") @map("render_config")
  placement           String?
  placementConfig     Json?                @default("{}") @map("placement_config")
  requiredPermissions String[]             @map("required_permissions")
  createdAt           DateTime             @default(now()) @map("created_at")
  updatedAt           DateTime             @updatedAt @map("updated_at")
  installation        ServiceInstallation? @relation("ServiceInstallationUIComponents", fields: [installationId], references: [id], onDelete: Cascade)
  service             ServiceRegistry      @relation("ServiceRegistryUIComponents", fields: [serviceId], references: [id], onDelete: Cascade)

  @@index([serviceId])
  @@index([installationId])
  @@map("service_ui_components")
}

model ServiceAPIRoute {
  id              String               @id @default(uuid()) @db.Uuid
  serviceId       String               @map("service_id") @db.Uuid
  installationId  String?              @map("installation_id") @db.Uuid
  routePath       String               @map("route_path")
  method          String
  targetUrl       String               @map("target_url")
  authType        String?              @map("auth_type")
  authConfig      Json?                @default("{}") @map("auth_config")
  rateLimit       Int?                 @map("rate_limit")
  rateLimitWindow Int?                 @map("rate_limit_window")
  cacheEnabled    Boolean              @default(false) @map("cache_enabled")
  cacheTtl        Int?                 @map("cache_ttl")
  createdAt       DateTime             @default(now()) @map("created_at")
  updatedAt       DateTime             @updatedAt @map("updated_at")
  installation    ServiceInstallation? @relation("ServiceInstallationAPIRoutes", fields: [installationId], references: [id], onDelete: Cascade)
  service         ServiceRegistry      @relation("ServiceRegistryAPIRoutes", fields: [serviceId], references: [id], onDelete: Cascade)

  @@index([serviceId])
  @@index([installationId])
  @@map("service_api_routes")
}

model InfrastructureInstance {
  id               String            @id @default(uuid()) @db.Uuid
  name             String
  type             String
  host             String
  port             Int?
  protocol         String            @default("ssh")
  connectionType   String            @map("connection_type")
  connectionConfig Json?             @default("{}") @map("connection_config")
  status           String            @default("unknown")
  lastHealthCheck  DateTime?         @map("last_health_check")
  healthStatus     Json?             @default("{}") @map("health_status")
  osType           String?           @map("os_type")
  osVersion        String?           @map("os_version")
  resources        Json?
  tags             String[]
  spaceId          String?           @map("space_id") @db.Uuid
  createdBy        String?           @map("created_by") @db.Uuid
  createdAt        DateTime          @default(now()) @map("created_at")
  updatedAt        DateTime          @updatedAt @map("updated_at")
  deletedAt        DateTime?         @map("deleted_at")
  creator          User?             @relation("UserInfrastructureInstances", fields: [createdBy], references: [id])
  space            Space?            @relation("SpaceInfrastructureInstances", fields: [spaceId], references: [id], onDelete: Cascade)
  services         InstanceService[] @relation("InfrastructureInstanceServices")

  @@index([spaceId])
  @@index([type])
  @@index([status])
  @@map("infrastructure_instances")
}

model InstanceService {
  id                    String                        @id @default(uuid()) @db.Uuid
  instanceId            String                        @map("instance_id") @db.Uuid
  name                  String
  type                  String
  status                String                        @default("unknown")
  serviceConfig         Json?                         @default("{}") @map("service_config")
  endpoints             Json?                         @default("[]")
  healthCheckUrl        String?                       @map("health_check_url")
  managementPluginId    String?                       @map("management_plugin_id") @db.Uuid
  managementConfig      Json?                         @default("{}") @map("management_config")
  discoveredAt          DateTime                      @default(now()) @map("discovered_at")
  lastSeen              DateTime                      @default(now()) @map("last_seen")
  createdAt             DateTime                      @default(now()) @map("created_at")
  updatedAt             DateTime                      @updatedAt @map("updated_at")
  instance              InfrastructureInstance        @relation("InfrastructureInstanceServices", fields: [instanceId], references: [id], onDelete: Cascade)
  managementPlugin      ServiceRegistry?              @relation("ServiceRegistryManagementPlugins", fields: [managementPluginId], references: [id])
  managementAssignments ServiceManagementAssignment[] @relation("InstanceServiceManagementAssignments")

  @@unique([instanceId, name, type])
  @@index([instanceId])
  @@index([managementPluginId])
  @@index([status])
  @@map("instance_services")
}

model ServiceManagementAssignment {
  id                String          @id @default(uuid()) @db.Uuid
  instanceServiceId String          @map("instance_service_id") @db.Uuid
  pluginId          String          @map("plugin_id") @db.Uuid
  assignedBy        String?         @map("assigned_by") @db.Uuid
  assignedAt        DateTime        @default(now()) @map("assigned_at")
  config            Json?           @default("{}")
  credentials       Json?           @default("{}")
  isActive          Boolean         @default(true) @map("is_active")
  lastUsed          DateTime?       @map("last_used")
  assigner          User?           @relation("UserServiceManagementAssignments", fields: [assignedBy], references: [id])
  instanceService   InstanceService @relation("InstanceServiceManagementAssignments", fields: [instanceServiceId], references: [id], onDelete: Cascade)
  plugin            ServiceRegistry @relation("ServiceRegistryManagementAssignments", fields: [pluginId], references: [id], onDelete: Cascade)

  @@unique([instanceServiceId, pluginId])
  @@index([instanceServiceId])
  @@index([pluginId])
  @@map("service_management_assignments")
}

model PluginReview {
  id           String                @id @default(uuid()) @db.Uuid
  serviceId    String                @map("service_id") @db.Uuid
  userId       String                @map("user_id") @db.Uuid
  spaceId      String?               @map("space_id") @db.Uuid
  rating       Int
  title        String?
  comment      String?
  helpfulCount Int                   @default(0) @map("helpful_count")
  isVerified   Boolean               @default(false) @map("is_verified")
  createdAt    DateTime              @default(now()) @map("created_at")
  updatedAt    DateTime              @updatedAt @map("updated_at")
  deletedAt    DateTime?             @map("deleted_at")
  helpful      PluginReviewHelpful[] @relation("ReviewHelpful")
  service      ServiceRegistry       @relation("ServiceRegistryReviews", fields: [serviceId], references: [id], onDelete: Cascade)
  space        Space?                @relation("SpacePluginReviews", fields: [spaceId], references: [id], onDelete: Cascade)
  user         User                  @relation("UserPluginReviews", fields: [userId], references: [id], onDelete: Cascade)

  @@unique([serviceId, userId, spaceId])
  @@index([serviceId])
  @@index([userId])
  @@index([spaceId])
  @@index([rating])
  @@map("plugin_reviews")
}

model PluginReviewHelpful {
  id        String       @id @default(uuid()) @db.Uuid
  reviewId  String       @map("review_id") @db.Uuid
  userId    String       @map("user_id") @db.Uuid
  createdAt DateTime     @default(now()) @map("created_at")
  review    PluginReview @relation("ReviewHelpful", fields: [reviewId], references: [id], onDelete: Cascade)
  user      User         @relation("UserPluginReviewHelpful", fields: [userId], references: [id], onDelete: Cascade)

  @@unique([reviewId, userId])
  @@index([reviewId])
  @@index([userId])
  @@map("plugin_review_helpful")
}

model KnowledgeCollection {
  id          String                      @id @default(uuid()) @db.Uuid
  name        String
  description String?
  icon        String?
  color       String?
  isPrivate   Boolean                     @default(false) @map("is_private")
  spaceId     String?                     @map("space_id") @db.Uuid
  createdBy   String                      @map("created_by") @db.Uuid
  createdAt   DateTime                    @default(now()) @map("created_at")
  updatedAt   DateTime                    @updatedAt @map("updated_at")
  deletedAt   DateTime?                   @map("deleted_at")
  members     KnowledgeCollectionMember[] @relation("CollectionMembers")
  creator     User                        @relation("UserKnowledgeCollections", fields: [createdBy], references: [id])
  space       Space?                      @relation("SpaceKnowledgeCollections", fields: [spaceId], references: [id], onDelete: Cascade)
  documents   KnowledgeDocument[]         @relation("CollectionDocuments")
  shares      KnowledgeShare[]            @relation("CollectionShares")

  @@index([spaceId])
  @@index([createdBy])
  @@index([deletedAt])
  @@map("knowledge_collections")
}

model KnowledgeCollectionMember {
  id           String              @id @default(uuid()) @db.Uuid
  collectionId String              @map("collection_id") @db.Uuid
  userId       String              @map("user_id") @db.Uuid
  role         String              @default("viewer")
  createdAt    DateTime            @default(now()) @map("created_at")
  updatedAt    DateTime            @updatedAt @map("updated_at")
  collection   KnowledgeCollection @relation("CollectionMembers", fields: [collectionId], references: [id], onDelete: Cascade)
  user         User                @relation("UserKnowledgeCollectionMembers", fields: [userId], references: [id], onDelete: Cascade)

  @@unique([collectionId, userId])
  @@index([collectionId])
  @@index([userId])
  @@map("knowledge_collection_members")
}

model KnowledgeDocument {
  id           String                     @id @default(uuid()) @db.Uuid
  collectionId String                     @map("collection_id") @db.Uuid
  title        String
  content      String
  contentHtml  String?                    @map("content_html")
  parentId     String?                    @map("parent_id") @db.Uuid
  templateId   String?                    @map("template_id") @db.Uuid
  isTemplate   Boolean                    @default(false) @map("is_template")
  isPublic     Boolean                    @default(false) @map("is_public")
  isPinned     Boolean                    @default(false) @map("is_pinned")
  publishedAt  DateTime?                  @map("published_at")
  archivedAt   DateTime?                  @map("archived_at")
  order        Int                        @default(0)
  createdBy    String                     @map("created_by") @db.Uuid
  updatedBy    String?                    @map("updated_by") @db.Uuid
  createdAt    DateTime                   @default(now()) @map("created_at")
  updatedAt    DateTime                   @updatedAt @map("updated_at")
  deletedAt    DateTime?                  @map("deleted_at")
  comments     KnowledgeComment[]         @relation("DocumentComments")
  versions     KnowledgeDocumentVersion[] @relation("DocumentVersions")
  collection   KnowledgeCollection        @relation("CollectionDocuments", fields: [collectionId], references: [id], onDelete: Cascade)
  creator      User                       @relation("UserKnowledgeDocuments", fields: [createdBy], references: [id])
  parent       KnowledgeDocument?         @relation("DocumentHierarchy", fields: [parentId], references: [id])
  children     KnowledgeDocument[]        @relation("DocumentHierarchy")
  updater      User?                      @relation("UserKnowledgeDocumentUpdates", fields: [updatedBy], references: [id])
  mentions     KnowledgeMention[]         @relation("DocumentMentions")
  presence     KnowledgePresence[]        @relation("DocumentPresence")
  shares       KnowledgeShare[]           @relation("DocumentShares")
  stars        KnowledgeStar[]            @relation("DocumentStars")

  @@index([collectionId])
  @@index([parentId])
  @@index([createdBy])
  @@index([deletedAt])
  @@index([isPublic])
  @@map("knowledge_documents")
}

model KnowledgeDocumentVersion {
  id          String            @id @default(uuid()) @db.Uuid
  documentId  String            @map("document_id") @db.Uuid
  title       String
  content     String
  contentHtml String?           @map("content_html")
  createdBy   String            @map("created_by") @db.Uuid
  createdAt   DateTime          @default(now()) @map("created_at")
  creator     User              @relation("UserKnowledgeDocumentVersions", fields: [createdBy], references: [id])
  document    KnowledgeDocument @relation("DocumentVersions", fields: [documentId], references: [id], onDelete: Cascade)

  @@index([documentId])
  @@index([createdAt])
  @@map("knowledge_document_versions")
}

model KnowledgeComment {
  id          String             @id @default(uuid()) @db.Uuid
  documentId  String             @map("document_id") @db.Uuid
  parentId    String?            @map("parent_id") @db.Uuid
  content     String
  contentHtml String?            @map("content_html")
  resolvedAt  DateTime?          @map("resolved_at")
  resolvedBy  String?            @map("resolved_by") @db.Uuid
  createdBy   String             @map("created_by") @db.Uuid
  createdAt   DateTime           @default(now()) @map("created_at")
  updatedAt   DateTime           @updatedAt @map("updated_at")
  deletedAt   DateTime?          @map("deleted_at")
  creator     User               @relation("UserKnowledgeComments", fields: [createdBy], references: [id])
  document    KnowledgeDocument  @relation("DocumentComments", fields: [documentId], references: [id], onDelete: Cascade)
  parent      KnowledgeComment?  @relation("CommentThread", fields: [parentId], references: [id])
  replies     KnowledgeComment[] @relation("CommentThread")
  resolver    User?              @relation("UserKnowledgeCommentResolutions", fields: [resolvedBy], references: [id])

  @@index([documentId])
  @@index([parentId])
  @@index([createdBy])
  @@index([deletedAt])
  @@map("knowledge_comments")
}

model KnowledgeShare {
  id           String               @id @default(uuid()) @db.Uuid
  documentId   String?              @map("document_id") @db.Uuid
  collectionId String?              @map("collection_id") @db.Uuid
  userId       String?              @map("user_id") @db.Uuid
  teamId       String?              @map("team_id") @db.Uuid
  permission   String               @default("read")
  publicLink   String?              @unique @map("public_link")
  expiresAt    DateTime?            @map("expires_at")
  createdBy    String               @map("created_by") @db.Uuid
  createdAt    DateTime             @default(now()) @map("created_at")
  updatedAt    DateTime             @updatedAt @map("updated_at")
  collection   KnowledgeCollection? @relation("CollectionShares", fields: [collectionId], references: [id], onDelete: Cascade)
  creator      User                 @relation("UserKnowledgeShareCreators", fields: [createdBy], references: [id])
  document     KnowledgeDocument?   @relation("DocumentShares", fields: [documentId], references: [id], onDelete: Cascade)
  user         User?                @relation("UserKnowledgeShares", fields: [userId], references: [id], onDelete: Cascade)

  @@index([documentId])
  @@index([collectionId])
  @@index([userId])
  @@index([publicLink])
  @@map("knowledge_shares")
}

model KnowledgeStar {
  id         String            @id @default(uuid()) @db.Uuid
  documentId String            @map("document_id") @db.Uuid
  userId     String            @map("user_id") @db.Uuid
  createdAt  DateTime          @default(now()) @map("created_at")
  document   KnowledgeDocument @relation("DocumentStars", fields: [documentId], references: [id], onDelete: Cascade)
  user       User              @relation("UserKnowledgeStars", fields: [userId], references: [id], onDelete: Cascade)

  @@unique([documentId, userId])
  @@index([documentId])
  @@index([userId])
  @@map("knowledge_stars")
}

model KnowledgeMention {
  id         String            @id @default(uuid()) @db.Uuid
  documentId String            @map("document_id") @db.Uuid
  userId     String            @map("user_id") @db.Uuid
  createdBy  String            @map("created_by") @db.Uuid
  createdAt  DateTime          @default(now()) @map("created_at")
  creator    User              @relation("UserKnowledgeMentionCreators", fields: [createdBy], references: [id])
  document   KnowledgeDocument @relation("DocumentMentions", fields: [documentId], references: [id], onDelete: Cascade)
  user       User              @relation("UserKnowledgeMentions", fields: [userId], references: [id], onDelete: Cascade)

  @@unique([documentId, userId, createdBy])
  @@index([documentId])
  @@index([userId])
  @@map("knowledge_mentions")
}

model KnowledgePresence {
  id         String            @id @default(uuid()) @db.Uuid
  documentId String            @map("document_id") @db.Uuid
  userId     String            @map("user_id") @db.Uuid
  cursor     Json?
  selection  Json?
  lastSeen   DateTime          @default(now()) @map("last_seen")
  document   KnowledgeDocument @relation("DocumentPresence", fields: [documentId], references: [id], onDelete: Cascade)
  user       User              @relation("UserKnowledgePresence", fields: [userId], references: [id], onDelete: Cascade)

  @@unique([documentId, userId])
  @@index([documentId])
  @@index([userId])
  @@index([lastSeen])
  @@map("knowledge_presence")
}

model ApiWorkspace {
  id           String           @id @default(uuid()) @db.Uuid
  name         String
  description  String?
  isPersonal   Boolean          @default(true) @map("is_personal")
  spaceId      String?          @map("space_id") @db.Uuid
  createdBy    String           @map("created_by") @db.Uuid
  createdAt    DateTime         @default(now()) @map("created_at")
  updatedAt    DateTime         @updatedAt @map("updated_at")
  collections  ApiCollection[]  @relation("WorkspaceCollections")
  environments ApiEnvironment[] @relation("WorkspaceEnvironments")
  creator      User             @relation("UserApiWorkspaces", fields: [createdBy], references: [id])
  space        Space?           @relation("SpaceApiWorkspaces", fields: [spaceId], references: [id], onDelete: Cascade)

  @@index([createdBy])
  @@index([spaceId])
  @@map("api_workspaces")
}

model ApiCollection {
  id          String          @id @default(uuid()) @db.Uuid
  workspaceId String          @map("workspace_id") @db.Uuid
  parentId    String?         @map("parent_id") @db.Uuid
  name        String
  description String?
  order       Int             @default(0)
  createdBy   String          @map("created_by") @db.Uuid
  createdAt   DateTime        @default(now()) @map("created_at")
  updatedAt   DateTime        @updatedAt @map("updated_at")
  creator     User            @relation("UserApiCollections", fields: [createdBy], references: [id])
  parent      ApiCollection?  @relation("CollectionHierarchy", fields: [parentId], references: [id], onDelete: Cascade)
  children    ApiCollection[] @relation("CollectionHierarchy")
  workspace   ApiWorkspace    @relation("WorkspaceCollections", fields: [workspaceId], references: [id], onDelete: Cascade)
  requests    ApiRequest[]    @relation("CollectionRequests")

  @@index([workspaceId])
  @@index([parentId])
  @@index([createdBy])
  @@map("api_collections")
}

model ApiRequest {
  id               String              @id @default(uuid()) @db.Uuid
  collectionId     String?             @map("collection_id") @db.Uuid
  name             String
  method           String              @default("GET")
  url              String
  headers          Json                @default("[]")
  params           Json                @default("[]")
  body             String?
  bodyType         String?             @map("body_type")
  authType         String?             @map("auth_type")
  authConfig       Json?               @map("auth_config")
  preRequestScript String?             @map("pre_request_script")
  testScript       String?             @map("test_script")
  requestType      String              @default("REST") @map("request_type")
  graphqlQuery     String?             @map("graphql_query")
  graphqlVariables String?             @map("graphql_variables")
  order            Int                 @default(0)
  createdBy        String              @map("created_by") @db.Uuid
  createdAt        DateTime            @default(now()) @map("created_at")
  updatedAt        DateTime            @updatedAt @map("updated_at")
  history          ApiRequestHistory[] @relation("RequestHistory")
  collection       ApiCollection?      @relation("CollectionRequests", fields: [collectionId], references: [id])
  creator          User                @relation("UserApiRequests", fields: [createdBy], references: [id])

  @@index([collectionId])
  @@index([createdBy])
  @@map("api_requests")
}

model ApiEnvironment {
  id          String       @id @default(uuid()) @db.Uuid
  workspaceId String       @map("workspace_id") @db.Uuid
  name        String
  variables   Json         @default("[]")
  isGlobal    Boolean      @default(false) @map("is_global")
  createdBy   String       @map("created_by") @db.Uuid
  createdAt   DateTime     @default(now()) @map("created_at")
  updatedAt   DateTime     @updatedAt @map("updated_at")
  creator     User         @relation("UserApiEnvironments", fields: [createdBy], references: [id])
  workspace   ApiWorkspace @relation("WorkspaceEnvironments", fields: [workspaceId], references: [id], onDelete: Cascade)

  @@index([workspaceId])
  @@index([createdBy])
  @@map("api_environments")
}

model ApiRequestHistory {
  id              String      @id @default(uuid()) @db.Uuid
  requestId       String?     @map("request_id") @db.Uuid
  method          String
  url             String
  headers         Json        @default("{}")
  body            String?
  statusCode      Int?        @map("status_code")
  statusText      String?     @map("status_text")
  responseHeaders Json?       @map("response_headers")
  responseBody    String?     @map("response_body")
  responseTime    Int?        @map("response_time")
  error           String?
  createdBy       String      @map("created_by") @db.Uuid
  createdAt       DateTime    @default(now()) @map("created_at")
  creator         User        @relation("UserApiRequestHistory", fields: [createdBy], references: [id])
  request         ApiRequest? @relation("RequestHistory", fields: [requestId], references: [id])

  @@index([requestId])
  @@index([createdBy])
  @@index([createdAt])
  @@map("api_request_history")
}

model Theme {
  id          String   @id @default(uuid()) @db.Uuid
  name        String
  description String?
  themeMode   String   @default("light") @map("theme_mode")
  tags        String[] @default([])
  isActive    Boolean  @default(false) @map("is_active")
  isDefault   Boolean  @default(false) @map("is_default")
  config      Json
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  @@index([isActive])
  @@index([isDefault])
  @@index([themeMode])
  @@index([tags], type: Gin)
  @@map("themes")
}

model WebsitePWA {
  id                  String              @id @default(uuid()) @db.Uuid
  name                String
  description         String?
  url                 String
  iconUrl             String?             @map("icon_url")
  themeColor          String?             @default("#ffffff") @map("theme_color")
  bgColor             String?             @default("#ffffff") @map("bg_color")
  shortName           String?             @map("short_name")
  displayMode         String              @default("standalone") @map("display_mode")
  orientation         String              @default("any")
  scope               String              @default("/")
  startUrl            String              @default("/") @map("start_url")
  screenshots         String[]            @default([])
  categories          String[]            @default([])
  shortcuts           Json?               @default("[]")
  manifestParams      Json?               @default("{}")
  installMode         String              @default("browser") @map("install_mode")
  promptDelay         Int                 @default(0) @map("prompt_delay")
  installBannerConfig Json?               @default("{}") @map("install_banner_config")
  isPublished         Boolean             @default(false) @map("is_published")
  currentVersion      String?             @map("current_version")
  createdBy           String              @map("created_by") @db.Uuid
  spaceId             String?             @map("space_id") @db.Uuid
  createdAt           DateTime            @default(now()) @map("created_at")
  updatedAt           DateTime            @updatedAt @map("updated_at")
  deletedAt           DateTime?           @map("deleted_at")
  versions            WebsitePWAVersion[] @relation("WebsitePWAVersions")
  creator             User                @relation("WebsitePWACreator", fields: [createdBy], references: [id])
  space               Space?              @relation("SpaceWebsitePWAs", fields: [spaceId], references: [id])

  @@map("website_pwas")
}

model WebsitePWAVersion {
  id          String     @id @default(uuid()) @db.Uuid
  pwaId       String     @map("pwa_id") @db.Uuid
  version     String
  config      Json
  changeLog   String?    @map("change_log")
  isPublished Boolean    @default(false) @map("is_published")
  publishedAt DateTime?  @map("published_at")
  createdBy   String     @map("created_by") @db.Uuid
  createdAt   DateTime   @default(now()) @map("created_at")
  creator     User       @relation("WebsitePWAVersionCreator", fields: [createdBy], references: [id])
  pwa         WebsitePWA @relation("WebsitePWAVersions", fields: [pwaId], references: [id], onDelete: Cascade)

  @@map("website_pwa_versions")
}

model MenuGroup {
  id        String     @id @default(uuid()) @db.Uuid
  slug      String     @unique
  name      String
  icon      String
  priority  Int        @default(100)
  isVisible Boolean    @default(true) @map("is_visible")
  createdAt DateTime   @default(now()) @map("created_at")
  updatedAt DateTime   @updatedAt @map("updated_at")
  items     MenuItem[] @relation("MenuGroupItems")

  @@map("menu_groups")
}

model MenuItem {
  id             String           @id @default(uuid()) @db.Uuid
  groupId        String           @map("group_id") @db.Uuid
  slug           String           @unique
  name           String
  icon           String
  href           String
  section        String?
  priority       Int              @default(100)
  isVisible      Boolean          @default(true) @map("is_visible")
  isBuiltin      Boolean          @default(true) @map("is_builtin")
  sourcePluginId String?          @map("source_plugin_id") @db.Uuid
  requiredRoles  String[]         @default([]) @map("required_roles")
  createdAt      DateTime         @default(now()) @map("created_at")
  updatedAt      DateTime         @updatedAt @map("updated_at")
  group          MenuGroup        @relation("MenuGroupItems", fields: [groupId], references: [id], onDelete: Cascade)
  sourcePlugin   ServiceRegistry? @relation("PluginMenuItems", fields: [sourcePluginId], references: [id])

  @@map("menu_items")
}

model Report {
  id                 String               @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name               String               @db.VarChar(255)
  description        String?
  source             String               @db.VarChar(50)
  categoryId         String?              @map("category_id") @db.Uuid
  folderId           String?              @map("folder_id") @db.Uuid
  owner              String?              @db.VarChar(255)
  link               String?
  workspace          String?              @db.VarChar(255)
  embedUrl           String?              @map("embed_url")
  metadata           Json?                @default("{}")
  isActive           Boolean?             @default(true) @map("is_active")
  isPublic           Boolean?             @default(false) @map("is_public")
  createdAt          DateTime?            @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt          DateTime?            @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)
  deletedAt          DateTime?            @map("deleted_at") @db.Timestamptz(6)
  createdBy          String?              @map("created_by") @db.Uuid
  permissions        ReportPermission[]   @relation("ReportPermissions")
  report_share_links report_share_links[]
  spaces             ReportSpace[]        @relation("ReportSpaces")
  report_versions    report_versions[]
  category           ReportCategory?      @relation("CategoryReports", fields: [categoryId], references: [id], onUpdate: NoAction)
  users              User?                @relation(fields: [createdBy], references: [id], onUpdate: NoAction)
  folder             ReportFolder?        @relation("FolderReports", fields: [folderId], references: [id], onUpdate: NoAction)

  @@index([categoryId], map: "idx_reports_category_id")
  @@index([createdBy], map: "idx_reports_created_by")
  @@index([deletedAt], map: "idx_reports_deleted_at")
  @@index([folderId], map: "idx_reports_folder_id")
  @@index([isActive], map: "idx_reports_is_active")
  @@index([metadata], map: "idx_reports_metadata", type: Gin)
  @@index([source], map: "idx_reports_source")
  @@map("reports")
}

model ReportSpace {
  id        String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  reportId  String    @map("report_id") @db.Uuid
  spaceId   String    @map("space_id") @db.Uuid
  createdAt DateTime? @default(now()) @map("created_at") @db.Timestamptz(6)
  report    Report    @relation("ReportSpaces", fields: [reportId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  space     Space     @relation("SpaceReports", fields: [spaceId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([reportId, spaceId])
  @@index([reportId], map: "idx_report_spaces_report_id")
  @@index([spaceId], map: "idx_report_spaces_space_id")
  @@map("report_spaces")
}

model ReportCategory {
  id                      String             @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name                    String             @db.VarChar(255)
  description             String?
  parent_id               String?            @db.Uuid
  createdAt               DateTime?          @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt               DateTime?          @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)
  deletedAt               DateTime?          @map("deleted_at") @db.Timestamptz(6)
  created_by              String?            @db.Uuid
  users                   User?              @relation(fields: [created_by], references: [id], onUpdate: NoAction)
  report_categories       ReportCategory?    @relation("report_categoriesToreport_categories", fields: [parent_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  other_report_categories ReportCategory[]   @relation("report_categoriesToreport_categories")
  report_templates        report_templates[]
  reports                 Report[]           @relation("CategoryReports")

  @@unique([name, parent_id])
  @@index([deletedAt], map: "idx_report_categories_deleted_at")
  @@index([parent_id], map: "idx_report_categories_parent_id")
  @@map("report_categories")
}

model ReportFolder {
  id               String             @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name             String             @db.VarChar(255)
  description      String?
  parentId         String?            @map("parent_id") @db.Uuid
  createdAt        DateTime?          @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt        DateTime?          @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)
  deletedAt        DateTime?          @map("deleted_at") @db.Timestamptz(6)
  created_by       String?            @db.Uuid
  users            User?              @relation(fields: [created_by], references: [id], onUpdate: NoAction)
  parent           ReportFolder?      @relation("FolderHierarchy", fields: [parentId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  children         ReportFolder[]     @relation("FolderHierarchy")
  report_templates report_templates[]
  reports          Report[]           @relation("FolderReports")

  @@unique([name, parentId])
  @@index([deletedAt], map: "idx_report_folders_deleted_at")
  @@index([parentId], map: "idx_report_folders_parent_id")
  @@map("report_folders")
}

model ReportPermission {
  id                                         String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  reportId                                   String    @map("report_id") @db.Uuid
  userId                                     String?   @map("user_id") @db.Uuid
  role_id                                    String?   @db.Uuid
  permission                                 String    @db.VarChar(50)
  createdAt                                  DateTime? @default(now()) @map("created_at") @db.Timestamptz(6)
  created_by                                 String?   @db.Uuid
  users_report_permissions_created_byTousers User?     @relation("report_permissions_created_byTousers", fields: [created_by], references: [id], onUpdate: NoAction)
  report                                     Report    @relation("ReportPermissions", fields: [reportId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  roles                                      Role?     @relation(fields: [role_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  users_report_permissions_user_idTousers    User?     @relation("report_permissions_user_idTousers", fields: [userId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([reportId, userId, role_id, permission])
  @@index([reportId], map: "idx_report_permissions_report_id")
  @@index([role_id], map: "idx_report_permissions_role_id")
  @@index([userId], map: "idx_report_permissions_user_id")
  @@map("report_permissions")
}

model MemberPermission {
  id          String   @id @default(uuid()) @db.Uuid
  userId      String   @map("user_id") @db.Uuid
  spaceId     String   @map("space_id") @db.Uuid
  permissions String[]
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  @@unique([userId, spaceId])
  @@map("member_permissions")
}

model report_audit_logs {
  id            String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id       String?   @db.Uuid
  action        String    @db.VarChar(100)
  resource_type String    @db.VarChar(50)
  resource_id   String?   @db.Uuid
  details       Json?
  ip_address    String?   @db.VarChar(45)
  user_agent    String?
  created_at    DateTime? @default(now()) @db.Timestamptz(6)
  users         User?     @relation(fields: [user_id], references: [id], onUpdate: NoAction)

  @@index([action], map: "idx_report_audit_logs_action")
  @@index([created_at(sort: Desc)], map: "idx_report_audit_logs_created_at")
  @@index([resource_type, resource_id], map: "idx_report_audit_logs_resource")
  @@index([user_id], map: "idx_report_audit_logs_user_id")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model report_integrations {
  id          String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name        String    @db.VarChar(255)
  source      String    @db.VarChar(50)
  access_type String    @db.VarChar(50)
  config      Json      @default("{}")
  is_active   Boolean?  @default(true)
  space_id    String?   @db.Uuid
  created_at  DateTime? @default(now()) @db.Timestamptz(6)
  updated_at  DateTime? @default(now()) @db.Timestamptz(6)
  deleted_at  DateTime? @db.Timestamptz(6)
  created_by  String?   @db.Uuid
  users       User?     @relation(fields: [created_by], references: [id], onUpdate: NoAction)
  spaces      Space?    @relation(fields: [space_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([config], map: "idx_report_integrations_config", type: Gin)
  @@index([created_by], map: "idx_report_integrations_created_by")
  @@index([deleted_at], map: "idx_report_integrations_deleted_at")
  @@index([source], map: "idx_report_integrations_source")
  @@index([space_id], map: "idx_report_integrations_space_id")
}

model report_share_links {
  id               String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  report_id        String?   @db.Uuid
  token            String    @unique @db.VarChar(255)
  password_hash    String?
  expires_at       DateTime? @db.Timestamptz(6)
  max_views        Int?
  view_count       Int?      @default(0)
  is_active        Boolean?  @default(true)
  created_by       String?   @db.Uuid
  created_at       DateTime? @default(now()) @db.Timestamptz(6)
  last_accessed_at DateTime? @db.Timestamptz(6)
  users            User?     @relation(fields: [created_by], references: [id], onUpdate: NoAction)
  reports          Report?   @relation(fields: [report_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([expires_at], map: "idx_report_share_links_expires_at")
  @@index([report_id], map: "idx_report_share_links_report_id")
  @@index([token], map: "idx_report_share_links_token")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model report_templates {
  id                String          @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name              String          @db.VarChar(255)
  description       String?
  source            String          @db.VarChar(50)
  category_id       String?         @db.Uuid
  folder_id         String?         @db.Uuid
  metadata          Json?
  is_public         Boolean?        @default(false)
  usage_count       Int?            @default(0)
  created_by        String?         @db.Uuid
  created_at        DateTime?       @default(now()) @db.Timestamptz(6)
  updated_at        DateTime?       @default(now()) @db.Timestamptz(6)
  deleted_at        DateTime?       @db.Timestamptz(6)
  report_categories ReportCategory? @relation(fields: [category_id], references: [id], onUpdate: NoAction)
  users             User?           @relation(fields: [created_by], references: [id], onUpdate: NoAction)
  report_folders    ReportFolder?   @relation(fields: [folder_id], references: [id], onUpdate: NoAction)

  @@index([deleted_at], map: "idx_report_templates_deleted_at")
  @@index([source], map: "idx_report_templates_source")
}

model report_versions {
  id             String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  report_id      String?   @db.Uuid
  version_number Int
  name           String    @db.VarChar(255)
  description    String?
  metadata       Json?
  created_by     String?   @db.Uuid
  created_at     DateTime? @default(now()) @db.Timestamptz(6)
  users          User?     @relation(fields: [created_by], references: [id], onUpdate: NoAction)
  reports        Report?   @relation(fields: [report_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([report_id, version_number])
  @@index([created_at(sort: Desc)], map: "idx_report_versions_created_at")
  @@index([report_id], map: "idx_report_versions_report_id")
}

model query_performance {
  id             String   @id
  query          String
  query_hash     String
  execution_time Int
  row_count      Int
  timestamp      DateTime @default(now()) @db.Timestamp(6)
  user_id        String?
  user_name      String?
  space_id       String?
  status         String
  error_message  String?
  is_slow        Boolean  @default(false)

  @@index([execution_time(sort: Desc)], map: "idx_query_performance_execution_time")
  @@index([query_hash], map: "idx_query_performance_query_hash")
  @@index([timestamp(sort: Desc)], map: "idx_query_performance_timestamp")
}
